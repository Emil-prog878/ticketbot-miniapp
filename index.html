<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>TicketBot</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;600;800&family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#080812;--bg2:#10101f;--bg3:#18182e;--bg4:#22223a;
  --accent:#7c3aed;--accent2:#a855f7;--gold:#f59e0b;
  --green:#10b981;--red:#ef4444;--text:#f0f0ff;--muted:#6b6b9a;--border:#2a2a4a;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden}
body{font-family:'Manrope',sans-serif;background:var(--bg);color:var(--text);font-size:14px}

/* ‚îÄ‚îÄ –ê–ù–ò–ú–ê–¶–ò–ò ‚îÄ‚îÄ */
@keyframes fadeUp  {from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn  {from{opacity:0}to{opacity:1}}
@keyframes pop     {0%{transform:scale(0) rotate(-15deg)}70%{transform:scale(1.18)}100%{transform:scale(1)}}
@keyframes shimmer {0%{background-position:200% 0}100%{background-position:-200% 0}}
@keyframes spin    {to{transform:rotate(360deg)}}
@keyframes glow    {0%,100%{box-shadow:0 0 20px rgba(124,58,237,.3)}50%{box-shadow:0 0 50px rgba(124,58,237,.7)}}
@keyframes bounce  {0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
@keyframes float   {0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
@keyframes ripple  {to{transform:scale(4);opacity:0}}
@keyframes slideUp {from{transform:translateY(100%)}to{transform:translateY(0)}}
@keyframes pulse   {0%,100%{opacity:1}50%{opacity:.4}}
@keyframes scan    {0%,100%{top:10%}50%{top:85%}}

.au{animation:fadeUp .4s cubic-bezier(.34,1.56,.64,1) both}
.ap{animation:pop .4s cubic-bezier(.34,1.56,.64,1) both}

/* ‚îÄ‚îÄ –ö–ù–û–ü–ö–ò ‚îÄ‚îÄ */
.btn{
  position:relative;overflow:hidden;
  display:inline-flex;align-items:center;justify-content:center;gap:8px;
  border:none;border-radius:14px;cursor:pointer;
  font-family:'Manrope',sans-serif;font-weight:700;font-size:14px;
  padding:14px 20px;transition:transform .15s,opacity .15s,box-shadow .25s;
  width:100%;
}
.btn:active{transform:scale(.96);opacity:.88}
.btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff}
.btn-primary:not(:disabled):hover{box-shadow:0 8px 32px rgba(124,58,237,.45)}
.btn-secondary{background:var(--bg3);color:var(--text);border:1px solid var(--border)}
.btn-danger{background:rgba(239,68,68,.12);color:var(--red);border:1px solid rgba(239,68,68,.25)}
.btn-success{background:rgba(16,185,129,.12);color:var(--green);border:1px solid rgba(16,185,129,.25)}
.btn-sm{padding:7px 13px;font-size:12px;border-radius:10px;width:auto}
.btn:disabled{opacity:.45;cursor:not-allowed;transform:none}
.ripple-el{position:absolute;border-radius:50%;background:rgba(255,255,255,.25);transform:scale(0);animation:ripple .55s linear;pointer-events:none}

/* ‚îÄ‚îÄ –°–¢–†–ê–ù–ò–¶–´ ‚îÄ‚îÄ */
.page{position:fixed;inset:0;display:flex;flex-direction:column;background:var(--bg);z-index:10;transition:opacity .28s,transform .28s}
.page.off{opacity:0;pointer-events:none;transform:translateX(18px)}

/* ‚îÄ‚îÄ –û–ù–ë–û–†–î–ò–ù–ì ‚îÄ‚îÄ */
#pgOnboard{
  align-items:center;justify-content:center;padding:32px 24px;text-align:center;
  background:radial-gradient(ellipse at 50% -10%,rgba(124,58,237,.25) 0%,transparent 65%),var(--bg);
}
.ob-emoji{font-size:80px;animation:float 3s ease-in-out infinite;display:block;margin-bottom:16px}
.ob-logo{
  font-family:'Unbounded',sans-serif;font-size:26px;font-weight:800;
  background:linear-gradient(135deg,var(--accent2),var(--gold));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:8px;
}
.ob-sub{color:var(--muted);font-size:13px;line-height:1.6;margin-bottom:36px}
.role-cards{display:flex;flex-direction:column;gap:12px;width:100%;max-width:340px}
.role-card{
  background:var(--bg2);border:2px solid var(--border);border-radius:20px;
  padding:18px 20px;cursor:pointer;text-align:left;
  display:flex;align-items:center;gap:16px;
  transition:all .25s cubic-bezier(.34,1.56,.64,1);
}
.role-card:active{transform:scale(.97)}
.role-card.buyer:hover{border-color:var(--green);background:rgba(16,185,129,.06);transform:translateY(-2px)}
.role-card.seller:hover{border-color:var(--gold);background:rgba(245,158,11,.06);transform:translateY(-2px)}
.rc-icon{font-size:38px;flex-shrink:0}
.rc-title{font-family:'Unbounded',sans-serif;font-size:14px;font-weight:700;margin-bottom:3px}
.rc-desc{font-size:11px;color:var(--muted)}
.rc-arr{color:var(--muted);font-size:18px;margin-left:auto;transition:transform .2s}
.role-card:hover .rc-arr{transform:translateX(4px);color:var(--text)}

/* ‚îÄ‚îÄ –®–ê–ü–ö–ê ‚îÄ‚îÄ */
.header{padding:10px 14px 8px;background:rgba(8,8,18,.92);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);flex-shrink:0}
.header-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.logo{font-family:'Unbounded',sans-serif;font-size:15px;font-weight:800;background:linear-gradient(135deg,var(--accent2),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hbtns{display:flex;gap:8px}
.hbtn{background:var(--bg3);border:1px solid var(--border);border-radius:11px;padding:7px 12px;color:var(--text);font-size:14px;cursor:pointer;transition:all .2s;position:relative}
.hbtn:active{transform:scale(.92)}
.hbadge{position:absolute;top:-5px;right:-5px;background:var(--accent);color:#fff;font-size:9px;font-weight:700;border-radius:99px;padding:2px 5px;min-width:17px;text-align:center;display:none;border:2px solid var(--bg)}
.hbadge.on{display:block;animation:pop .3s ease}
.search-wrap{position:relative;margin-bottom:7px}
.search-wrap input{width:100%;background:var(--bg3);border:1.5px solid var(--border);border-radius:12px;padding:8px 12px 8px 36px;color:var(--text);font-family:'Manrope',sans-serif;font-size:12px;outline:none;transition:border-color .2s}
.search-wrap input:focus{border-color:var(--accent)}
.search-wrap input::placeholder{color:var(--muted)}
.si{position:absolute;left:11px;top:50%;transform:translateY(-50%);font-size:14px;color:var(--muted);pointer-events:none}
.chips{display:flex;gap:7px;overflow-x:auto;scrollbar-width:none;padding-bottom:1px}
.chips::-webkit-scrollbar{display:none}
.chip{flex-shrink:0;background:var(--bg3);border:1px solid var(--border);border-radius:99px;padding:5px 12px;color:var(--muted);font-size:11px;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap}
.chip.on{background:var(--accent);border-color:var(--accent);color:#fff;transform:scale(1.05)}

/* ‚îÄ‚îÄ –°–ö–†–û–õ–õ ‚îÄ‚îÄ */
.scr{flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;padding:12px;padding-bottom:85px}
.scr::-webkit-scrollbar{display:none}

/* ‚îÄ‚îÄ –ö–ê–†–¢–û–ß–ö–ò ‚îÄ‚îÄ */
.ev-list{display:flex;flex-direction:column;gap:9px}
.ev-card{background:var(--bg2);border:1.5px solid var(--border);border-radius:15px;overflow:hidden;cursor:pointer;transition:border-color .2s,transform .15s,box-shadow .2s}
.ev-card:active{transform:scale(.985)}
.ev-card:hover{border-color:rgba(124,58,237,.4);box-shadow:0 4px 20px rgba(124,58,237,.12)}
.ev-inner{display:flex}
.ev-poster{width:88px;flex-shrink:0;background:var(--bg3);display:flex;align-items:center;justify-content:center;font-size:34px;min-height:108px;position:relative;overflow:hidden}
.ev-poster img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
.ev-poster-e{position:relative;z-index:1}
.ev-body{flex:1;padding:11px;display:flex;flex-direction:column;gap:4px}
.ev-cat{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--accent2)}
.ev-title{font-family:'Unbounded',sans-serif;font-size:11px;font-weight:700;line-height:1.3}
.ev-meta{font-size:10px;color:var(--muted)}
.ev-foot{display:flex;align-items:center;justify-content:space-between;margin-top:3px}
.ev-price{font-family:'Unbounded',sans-serif;font-size:12px;font-weight:700;color:var(--green)}
.seats-tag{font-size:9px;font-weight:700;padding:2px 7px;border-radius:99px;background:var(--bg4);color:var(--muted)}
.seats-tag.low{color:var(--red);background:rgba(239,68,68,.1)}

/* ‚îÄ‚îÄ –î–ï–¢–ê–õ–ò ‚îÄ‚îÄ */
#pgDetail{z-index:20}
.d-hero{height:190px;background:var(--bg3);display:flex;align-items:center;justify-content:center;font-size:68px;position:relative;overflow:hidden;flex-shrink:0}
.d-hero::after{content:'';position:absolute;bottom:0;left:0;right:0;height:70px;background:linear-gradient(transparent,var(--bg))}
.d-hero img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
.d-hero-e{position:relative;z-index:1}
.back-btn{position:absolute;top:12px;left:12px;z-index:10;background:rgba(0,0,0,.55);backdrop-filter:blur(10px);border:none;border-radius:99px;color:#fff;font-size:13px;padding:7px 12px;cursor:pointer;display:flex;align-items:center;gap:4px;transition:background .2s}
.back-btn:active{background:rgba(0,0,0,.8)}
.d-cat{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--accent2);margin-bottom:5px}
.d-title{font-family:'Unbounded',sans-serif;font-size:18px;font-weight:800;line-height:1.2;margin-bottom:13px}
.ig{display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-bottom:13px}
.ib{background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:9px}
.ib-l{font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:.7px;margin-bottom:2px}
.ib-v{font-size:12px;font-weight:600}
.d-desc{background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:11px;font-size:12px;line-height:1.6;color:var(--muted);margin-bottom:13px}
.sec{font-family:'Unbounded',sans-serif;font-size:10px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:9px}
.tt-list{display:flex;flex-direction:column;gap:7px;margin-bottom:13px}
.tt-card{background:var(--bg2);border:2px solid var(--border);border-radius:13px;padding:11px 13px;cursor:pointer;transition:all .2s cubic-bezier(.34,1.56,.64,1);display:flex;align-items:center;justify-content:space-between}
.tt-card.sel{border-color:var(--accent);background:rgba(124,58,237,.07)}
.tt-card.so{opacity:.4;cursor:not-allowed}
.tt-card:not(.so):active{transform:scale(.98)}
.tt-nm{font-weight:700;font-size:13px;margin-bottom:2px}
.tt-av{font-size:10px;color:var(--muted)}
.tt-av.low{color:var(--red)}
.tt-pr{font-family:'Unbounded',sans-serif;font-size:14px;font-weight:700;color:var(--green)}
.tt-rd{width:19px;height:19px;border-radius:50%;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:10px;transition:all .2s;flex-shrink:0;margin-left:9px}
.tt-card.sel .tt-rd{background:var(--accent);border-color:var(--accent);color:#fff}
.qty-row{display:flex;align-items:center;justify-content:space-between;background:var(--bg2);border:1px solid var(--border);border-radius:13px;padding:11px 13px;margin-bottom:14px}
.qty-lbl{font-size:13px;font-weight:600}
.qty-ctrl{display:flex;align-items:center;gap:13px}
.qty-btn{width:28px;height:28px;border-radius:50%;border:none;background:var(--bg4);color:var(--text);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s}
.qty-btn:active{background:var(--accent);transform:scale(.88)}
.qty-n{font-family:'Unbounded',sans-serif;font-size:18px;font-weight:700;min-width:20px;text-align:center}

/* ‚îÄ‚îÄ –ù–ò–ñ–ù–ò–ô –ë–ê–† ‚îÄ‚îÄ */
.bbar{padding:9px 13px max(env(safe-area-inset-bottom),9px);background:rgba(8,8,18,.95);backdrop-filter:blur(20px);border-top:1px solid var(--border);flex-shrink:0}

/* ‚îÄ‚îÄ SHEET ‚îÄ‚îÄ */
.sheet-wrap{position:fixed;inset:0;z-index:50;display:flex;flex-direction:column;justify-content:flex-end;pointer-events:none}
.sheet-wrap.on{pointer-events:all}
.sh-ov{position:absolute;inset:0;background:rgba(0,0,0,.6);opacity:0;transition:opacity .3s}
.sheet-wrap.on .sh-ov{opacity:1}
.sh-body{position:relative;z-index:1;background:var(--bg2);border-radius:22px 22px 0 0;border-top:1px solid var(--border);max-height:88vh;display:flex;flex-direction:column;transform:translateY(100%);transition:transform .35s cubic-bezier(.34,1.56,.64,1)}
.sheet-wrap.on .sh-body{transform:translateY(0)}
.sh-handle{width:36px;height:4px;background:var(--border);border-radius:99px;margin:9px auto 0}
.sh-hdr{padding:11px 15px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.sh-title{font-family:'Unbounded',sans-serif;font-size:14px;font-weight:700}
.sh-x{background:var(--bg3);border:1px solid var(--border);border-radius:99px;width:26px;height:26px;cursor:pointer;font-size:13px;display:flex;align-items:center;justify-content:center;transition:background .2s}
.sh-x:active{background:var(--bg4)}
.sh-scr{overflow-y:auto;flex:1;padding:11px}
.sh-scr::-webkit-scrollbar{display:none}
.sh-foot{padding:9px 13px max(env(safe-area-inset-bottom),9px);border-top:1px solid var(--border);flex-shrink:0}

/* ‚îÄ‚îÄ –ö–û–†–ó–ò–ù–ê ‚îÄ‚îÄ */
.cart-item{background:var(--bg3);border:1px solid var(--border);border-radius:13px;padding:11px;margin-bottom:7px;animation:fadeUp .25s ease both}
.ci-title{font-weight:700;font-size:13px;margin-bottom:2px}
.ci-sub{font-size:11px;color:var(--muted);margin-bottom:8px}
.ci-foot{display:flex;align-items:center;justify-content:space-between}
.ci-price{font-family:'Unbounded',sans-serif;font-size:13px;font-weight:700;color:var(--green)}
.total-row{display:flex;align-items:center;justify-content:space-between;padding:11px 0;border-top:1px solid var(--border);margin-top:3px}
.total-lbl{font-size:12px;color:var(--muted)}
.total-val{font-family:'Unbounded',sans-serif;font-size:20px;font-weight:800}

/* ‚îÄ‚îÄ PDF –ë–ò–õ–ï–¢ ‚îÄ‚îÄ */
#pgTicket{z-index:60;background:var(--bg);align-items:center;justify-content:center;padding:24px}
.ticket-wrap{
  width:100%;max-width:360px;background:#0f0f1a;border-radius:20px;overflow:hidden;
  box-shadow:0 20px 60px rgba(0,0,0,.6);animation:pop .4s ease;
}
.ticket-top{padding:20px;background:linear-gradient(135deg,#13132b,#1a0a3a)}
.ticket-label{font-family:'Unbounded',sans-serif;font-size:9px;font-weight:700;letter-spacing:2px;color:var(--accent2);margin-bottom:10px;text-transform:uppercase}
.ticket-event{font-family:'Unbounded',sans-serif;font-size:17px;font-weight:800;line-height:1.2;margin-bottom:14px;color:#fff}
.ticket-meta{display:flex;flex-direction:column;gap:6px}
.ticket-row{display:flex;align-items:center;gap:8px;font-size:12px;color:rgba(255,255,255,.7)}
.ticket-row span:first-child{font-size:14px}
.ticket-div{height:1px;background:repeating-linear-gradient(90deg,var(--accent) 0,var(--accent) 6px,transparent 6px,transparent 12px);margin:0;position:relative}
.ticket-div::before,.ticket-div::after{content:'';position:absolute;width:18px;height:18px;background:var(--bg);border-radius:50%;top:-9px}
.ticket-div::before{left:-9px}.ticket-div::after{right:-9px}
.ticket-bot{padding:18px 20px;display:flex;align-items:center;gap:16px}
.qr-wrap{flex-shrink:0;background:#fff;padding:8px;border-radius:10px;width:90px;height:90px;display:flex;align-items:center;justify-content:center}
.ticket-info{flex:1}
.ticket-type{font-family:'Unbounded',sans-serif;font-size:12px;font-weight:700;color:var(--accent2);margin-bottom:4px}
.ticket-id{font-size:9px;color:var(--muted);word-break:break-all;margin-bottom:8px}
.ticket-status{font-size:10px;font-weight:700;color:var(--green);background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.2);border-radius:99px;padding:3px 9px;display:inline-block}
.ticket-oferta{padding:10px 20px 20px;font-size:9px;color:rgba(255,255,255,.2);line-height:1.5;border-top:1px solid rgba(255,255,255,.05)}

/* ‚îÄ‚îÄ –£–°–ü–ï–• ‚îÄ‚îÄ */
#shSuccess .sh-body{background:linear-gradient(135deg,rgba(124,58,237,.15),rgba(168,85,247,.1)),var(--bg2);text-align:center;padding:30px 22px max(env(safe-area-inset-bottom),24px)}
.suc-icon{font-size:72px;display:block;margin-bottom:14px;animation:pop .5s .1s ease both}
.suc-title{font-family:'Unbounded',sans-serif;font-size:20px;font-weight:800;margin-bottom:8px}
.suc-sub{font-size:13px;color:var(--muted);line-height:1.6;margin-bottom:22px}

/* ‚îÄ‚îÄ –ü–†–û–î–ê–í–ï–¶ ‚îÄ‚îÄ */
#pgSeller{z-index:10}
.sel-tabs{display:flex;background:var(--bg2);border-bottom:1px solid var(--border);flex-shrink:0;overflow-x:auto;scrollbar-width:none}
.sel-tabs::-webkit-scrollbar{display:none}
.sel-tab{flex:1;min-width:70px;padding:11px 6px;text-align:center;font-size:10px;font-weight:600;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;transition:all .2s;white-space:nowrap}
.sel-tab.on{color:var(--accent);border-bottom-color:var(--accent)}

/* –°–¢–ê–¢ */
.stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:9px;margin-bottom:14px}
.stat-card{background:var(--bg2);border:1px solid var(--border);border-radius:14px;padding:13px}
.st-ico{font-size:22px;margin-bottom:5px}
.st-val{font-family:'Unbounded',sans-serif;font-size:19px;font-weight:800;margin-bottom:1px}
.st-lbl{font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px}
.prog-bar{height:3px;background:var(--bg4);border-radius:99px;overflow:hidden;margin:6px 0 3px}
.prog-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));border-radius:99px;transition:width .6s ease}

/* –§–û–†–ú–ê */
.fld{margin-bottom:11px}
.fl{font-size:10px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px;display:block}
.fi{width:100%;background:var(--bg3);border:1.5px solid var(--border);border-radius:12px;padding:10px 13px;color:var(--text);font-family:'Manrope',sans-serif;font-size:13px;outline:none;transition:border-color .2s}
.fi:focus{border-color:var(--accent)}
.fi::placeholder{color:var(--muted)}
select.fi option{background:var(--bg2)}
.frow{display:grid;grid-template-columns:1fr 1fr;gap:9px}

/* –ü–†–û–ú–û */
.promo-card{background:var(--bg2);border:1px solid var(--border);border-radius:13px;padding:11px 13px;margin-bottom:7px;display:flex;align-items:center;justify-content:space-between}
.pc{font-family:'Unbounded',sans-serif;font-size:12px;font-weight:700;color:var(--accent2)}
.pi{font-size:10px;color:var(--muted);margin-top:2px}

/* –°–ö–ê–ù–ï–† */
.scanner-box{background:var(--bg2);border:2px dashed var(--border);border-radius:18px;padding:28px 14px;text-align:center;margin-bottom:13px;cursor:pointer;transition:border-color .3s}
.scanner-box.act{border-color:var(--accent);animation:glow 2s ease infinite}
.scan-res{background:var(--bg2);border-radius:13px;padding:13px;border:2px solid;margin-bottom:11px;animation:fadeUp .3s ease}
.scan-res.ok{border-color:var(--green)}.scan-res.used{border-color:var(--red)}.scan-res.bad{border-color:var(--muted)}

/* –°–ö–ï–õ–ï–¢–û–ù */
.skel{background:linear-gradient(90deg,var(--bg2) 25%,var(--bg3) 50%,var(--bg2) 75%);background-size:200% 100%;animation:shimmer 1.4s infinite;border-radius:8px}

/* –¢–û–ê–°–¢ */
.toast{position:fixed;top:18px;left:50%;transform:translateX(-50%) translateY(-100px);background:var(--bg3);border:1px solid var(--border);border-radius:12px;padding:9px 16px;font-size:12px;font-weight:600;z-index:200;transition:transform .35s cubic-bezier(.34,1.56,.64,1);white-space:nowrap;box-shadow:0 8px 30px rgba(0,0,0,.5)}
.toast.show{transform:translateX(-50%) translateY(0)}
.toast.ok{border-color:var(--green);color:var(--green)}
.toast.err{border-color:var(--red);color:var(--red)}

/* –õ–û–ê–î–ï–† */
.loader{width:18px;height:18px;border:2px solid rgba(255,255,255,.2);border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite}

/* –ü–£–°–¢–û */
.empty{display:flex;flex-direction:column;align-items:center;padding:44px 16px;gap:9px;color:var(--muted);text-align:center}
.empty-ico{font-size:50px;animation:bounce 2s ease-in-out infinite}

.divider{height:1px;background:var(--border);margin:12px 0}
.badge-tag{display:inline-block;font-size:9px;font-weight:700;padding:2px 7px;border-radius:99px;background:var(--gold);color:#000;margin-left:6px}
</style>
</head>
<body>

<!-- –¢–û–ê–°–¢ -->
<div class="toast" id="toast"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –û–ù–ë–û–†–î–ò–ù–ì ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="pgOnboard">
  <span class="ob-emoji">üéü</span>
  <div class="ob-logo">TicketBot</div>
  <div class="ob-sub">–õ—É—á—à–∏–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –ø–æ–∫—É–ø–∫–∏<br>–∏ –ø—Ä–æ–¥–∞–∂–∏ –±–∏–ª–µ—Ç–æ–≤ –≤ Telegram</div>
  <div class="role-cards">
    <div class="role-card buyer au" style="animation-delay:.1s" onclick="chooseRole('buyer')">
      <span class="rc-icon">üé´</span>
      <div><div class="rc-title">–Ø –ø–æ–∫—É–ø–∞—Ç–µ–ª—å</div><div class="rc-desc">–ò—â—É —Å–æ–±—ã—Ç–∏—è –∏ –ø–æ–∫—É–ø–∞—é –±–∏–ª–µ—Ç—ã</div></div>
      <span class="rc-arr">‚Üí</span>
    </div>
    <div class="role-card seller au" style="animation-delay:.2s" onclick="chooseRole('seller')">
      <span class="rc-icon">üè™</span>
      <div><div class="rc-title">–Ø –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä</div><div class="rc-desc">–°–æ–∑–¥–∞—é —Å–æ–±—ã—Ç–∏—è –∏ —É–ø—Ä–∞–≤–ª—è—é –ø—Ä–æ–¥–∞–∂–∞–º–∏</div></div>
      <span class="rc-arr">‚Üí</span>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –ü–û–ö–£–ü–ê–¢–ï–õ–¨ ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page off" id="pgBuyer">
  <div class="header">
    <div class="header-top">
      <div class="logo">üéü TicketBot</div>
      <div class="hbtns">
        <div class="hbtn" onclick="openCart()">üõí<span class="hbadge" id="cartBadge">0</span></div>
        <div class="hbtn" style="font-size:11px;font-weight:600;color:var(--muted)" onclick="switchRole()">üè™ –ü—Ä–æ–¥–∞–≤–µ—Ü</div>
      </div>
    </div>
    <div class="search-wrap">
      <span class="si">üîç</span>
      <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ —Å–æ–±—ã—Ç–∏–π..." oninput="filterEvents()">
    </div>
    <div class="chips" id="chipsBar"></div>
  </div>
  <div class="scr" id="evList"></div>
  <div class="bbar" id="buyerBBar" style="display:none">
    <button class="btn btn-primary" onclick="openCart()">üõí –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É ¬∑ <span id="cartSum"></span></button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –î–ï–¢–ê–õ–ò ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page off" id="pgDetail">
  <div class="d-hero" id="dHero">
    <button class="back-btn" onclick="goBack()">‚Üê –ù–∞–∑–∞–¥</button>
    <span class="d-hero-e" id="dEmoji"></span>
  </div>
  <div class="scr" style="padding-top:0">
    <div style="padding:12px">
      <div class="d-cat" id="dCat"></div>
      <div class="d-title" id="dTitle"></div>
      <div class="ig" id="dGrid"></div>
      <div class="d-desc" id="dDesc" style="display:none"></div>
      <div class="sec">üé´ –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –±–∏–ª–µ—Ç–∞</div>
      <div class="tt-list" id="ttList"></div>
      <div class="qty-row">
        <span class="qty-lbl">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</span>
        <div class="qty-ctrl">
          <button class="qty-btn" onclick="chQty(-1)">‚àí</button>
          <span class="qty-n" id="qtyN">1</span>
          <button class="qty-btn" onclick="chQty(1)">+</button>
        </div>
      </div>
    </div>
  </div>
  <div class="bbar">
    <button class="btn btn-primary" id="addBtn" onclick="addCart()" disabled>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –±–∏–ª–µ—Ç–∞</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –ö–û–†–ó–ò–ù–ê (SHEET) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="sheet-wrap" id="shCart">
  <div class="sh-ov" onclick="closeCart()"></div>
  <div class="sh-body">
    <div class="sh-handle"></div>
    <div class="sh-hdr">
      <span class="sh-title">üõí –ö–æ—Ä–∑–∏–Ω–∞</span>
      <div class="sh-x" onclick="closeCart()">‚úï</div>
    </div>
    <div class="sh-scr" id="cartContent"></div>
    <div class="sh-foot">
      <button class="btn btn-primary" id="checkoutBtn" onclick="checkout()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PDF –ë–ò–õ–ï–¢ ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page off" id="pgTicket">
  <div class="ticket-wrap" id="ticketWrap">
    <div class="ticket-top">
      <div class="ticket-label">üéü –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –±–∏–ª–µ—Ç</div>
      <div class="ticket-event" id="tEvName"></div>
      <div class="ticket-meta">
        <div class="ticket-row"><span>üìÖ</span><span id="tDate"></span></div>
        <div class="ticket-row"><span>üìç</span><span id="tVenue"></span></div>
        <div class="ticket-row"><span>üîû</span><span id="tAge"></span></div>
      </div>
    </div>
    <div class="ticket-div"></div>
    <div class="ticket-bot">
      <div class="qr-wrap"><div id="ticketQR"></div></div>
      <div class="ticket-info">
        <div class="ticket-type" id="tType"></div>
        <div class="ticket-id" id="tId"></div>
        <div class="ticket-status">‚úÖ –î–ï–ô–°–¢–í–ò–¢–ï–õ–ï–ù</div>
      </div>
    </div>
    <div class="ticket-oferta">
      –ë–∏–ª–µ—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —É–¥–æ—Å—Ç–æ–≤–µ—Ä—è—é—â–µ–≥–æ –ª–∏—á–Ω–æ—Å—Ç—å. –í–æ–∑–≤—Ä–∞—Ç –∏ –æ–±–º–µ–Ω –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω.
      –û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –≤–ø—Ä–∞–≤–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É. –ü—Ä–∏–æ–±—Ä–µ—Ç–∞—è –±–∏–ª–µ—Ç –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –ø–æ—Å–µ—â–µ–Ω–∏—è.
      –ü–µ—Ä–µ–ø—Ä–æ–¥–∞–∂–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–∞.
    </div>
  </div>
  <div style="margin-top:16px;width:100%;max-width:360px;display:flex;flex-direction:column;gap:8px">
    <button class="btn btn-primary" onclick="downloadTicket()">üì• –°–∫–∞—á–∞—Ç—å –±–∏–ª–µ—Ç</button>
    <button class="btn btn-secondary" onclick="showSuccess()">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –£–°–ü–ï–• (SHEET) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="sheet-wrap" id="shSuccess">
  <div class="sh-ov"></div>
  <div class="sh-body">
    <div class="sh-handle"></div>
    <span class="suc-icon">üéâ</span>
    <div class="suc-title">–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω!</div>
    <div class="suc-sub" id="sucText">–í–∞—à–∏ –±–∏–ª–µ—Ç—ã –≥–æ—Ç–æ–≤—ã.<br>–ë–æ—Ç —Ç–∞–∫–∂–µ –ø—Ä–∏—à–ª—ë—Ç –∏—Ö –≤ —á–∞—Ç! üéü</div>
    <button class="btn btn-primary" onclick="viewTickets()" style="margin-bottom:8px">üé´ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –±–∏–ª–µ—Ç—ã</button>
    <button class="btn btn-secondary" onclick="closeSuccess()">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –ü–†–û–î–ê–í–ï–¶ ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page off" id="pgSeller">
  <div class="header">
    <div class="header-top">
      <div class="logo">üè™ –ö–∞–±–∏–Ω–µ—Ç</div>
      <div class="hbtns">
        <div class="hbtn" style="font-size:11px;font-weight:600;color:var(--muted)" onclick="switchRole()">üé´ –ü–æ–∫—É–ø–∞—Ç–µ–ª—å</div>
      </div>
    </div>
    <div class="sel-tabs" id="selTabs">
      <div class="sel-tab on" onclick="selTab('stats')">üìä –°—Ç–∞—Ç</div>
      <div class="sel-tab" onclick="selTab('events')">‚ûï –°–æ–±—ã—Ç–∏–µ</div>
      <div class="sel-tab" onclick="selTab('scan')">üì∑ –°–∫–∞–Ω–µ—Ä</div>
      <div class="sel-tab" onclick="selTab('promo')">üè∑ –ü—Ä–æ–º–æ</div>
    </div>
  </div>
  <div class="scr" id="selContent"></div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –ö–û–ù–§–ò–ì
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const API = "https://YOUR_BOT_BACKEND_URL"; // ‚Üê –∑–∞–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

const tg      = window.Telegram?.WebApp;
const haptic  = tg?.HapticFeedback;
if(tg){ tg.ready(); tg.expand(); tg.setHeaderColor('#080812'); tg.setBackgroundColor('#080812'); }
const UID  = tg?.initDataUnsafe?.user?.id   || null;
const UNAME= tg?.initDataUnsafe?.user?.first_name || "–ì–æ—Å—Ç—å";

// –°–û–°–¢–û–Ø–ù–ò–ï
let role='', cart=JSON.parse(localStorage.getItem('tg_cart')||'[]');
let allEvs=[], curEv=null, selectedTT=null, qty=1, curFilter='all', curSelTab='stats';
let lastOrderTickets=[];

// –î–ï–ú–û –î–ê–ù–ù–´–ï
const DEMO_EVTS=[
  {id:1,title:"Imagine Dragons Live",category:"concert",emoji:"üéµ",venue:"–û–ª–∏–º–ø–∏–π—Å–∫–∏–π",city:"–ú–æ—Å–∫–≤–∞",date:"15.06.2025",time:"19:00",age_rating:"12+",description:"–ì—Ä–∞–Ω–¥–∏–æ–∑–Ω–æ–µ —à–æ—É –º–∏—Ä–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è. –õ–∞–∑–µ—Ä—ã, –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ –∏ —Ö–∏—Ç—ã –∏–∑ –≤—Å–µ—Ö –∞–ª—å–±–æ–º–æ–≤.",
   ticket_types:[{id:1,name:"–°—Ç–∞–Ω–¥–∞—Ä—Ç",price:3500,available:120,total:200},{id:2,name:"VIP",price:8500,available:8,total:30},{id:3,name:"–°—Ç—É–¥–µ–Ω—Ç",price:2200,available:40,total:50}]},
  {id:2,title:"–õ–µ–±–µ–¥–∏–Ω–æ–µ –æ–∑–µ—Ä–æ",category:"theater",emoji:"üé≠",venue:"–ë–æ–ª—å—à–æ–π —Ç–µ–∞—Ç—Ä",city:"–ú–æ—Å–∫–≤–∞",date:"22.06.2025",time:"18:30",age_rating:"0+",description:"–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –±–∞–ª–µ—Ç –ß–∞–π–∫–æ–≤—Å–∫–æ–≥–æ –≤ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤–µ–¥—É—â–µ–π —Ç—Ä—É–ø–ø—ã —Å—Ç—Ä–∞–Ω—ã.",
   ticket_types:[{id:4,name:"–ü–∞—Ä—Ç–µ—Ä",price:5000,available:80,total:150},{id:5,name:"–ë–∞–ª–∫–æ–Ω",price:2500,available:200,total:300},{id:6,name:"–õ–æ–∂–∞ VIP",price:12000,available:4,total:8}]},
  {id:3,title:"UFC Fight Night",category:"sport",emoji:"ü•ä",venue:"–õ—É–∂–Ω–∏–∫–∏",city:"–ú–æ—Å–∫–≤–∞",date:"30.06.2025",time:"20:00",age_rating:"16+",description:"–í–µ—á–µ—Ä —Å–º–µ—à–∞–Ω–Ω—ã—Ö –µ–¥–∏–Ω–æ–±–æ—Ä—Å—Ç–≤ —Å —É—á–∞—Å—Ç–∏–µ–º —Ç–æ–ø–æ–≤—ã—Ö –±–æ–π—Ü–æ–≤.",
   ticket_types:[{id:7,name:"–¢—Ä–∏–±—É–Ω–∞",price:2000,available:500,total:1000},{id:8,name:"–†–∏–Ω–≥-—Å–∞–π–¥",price:15000,available:3,total:20}]},
  {id:4,title:"–ü–∏–∫–Ω–∏–∫ –ê—Ñ–∏—à–∏ 2025",category:"festival",emoji:"üé™",venue:"–ö–æ–ª–æ–º–µ–Ω—Å–∫–æ–µ",city:"–ú–æ—Å–∫–≤–∞",date:"12.07.2025",time:"12:00",age_rating:"0+",description:"–ì–ª–∞–≤–Ω—ã–π –ª–µ—Ç–Ω–∏–π —Ñ–µ—Å—Ç–∏–≤–∞–ª—å —Å 30+ –∞—Ä—Ç–∏—Å—Ç–∞–º–∏ –Ω–∞ 5 —Å—Ü–µ–Ω–∞—Ö.",
   ticket_types:[{id:9,name:"–û–¥–Ω–æ–¥–Ω–µ–≤–Ω—ã–π",price:4500,available:1000,total:5000},{id:10,name:"VIP-–∑–æ–Ω–∞",price:12000,available:50,total:100}]},
  {id:5,title:"–í—ã—Å—Ç–∞–≤–∫–∞ –ú–æ–Ω–µ",category:"exhibition",emoji:"üñº",venue:"–¢—Ä–µ—Ç—å—è–∫–æ–≤—Å–∫–∞—è –≥–∞–ª–µ—Ä–µ—è",city:"–ú–æ—Å–∫–≤–∞",date:"01.06.2025",time:"10:00",age_rating:"0+",description:"–£–Ω–∏–∫–∞–ª—å–Ω–∞—è –≤—ã—Å—Ç–∞–≤–∫–∞ —à–µ–¥–µ–≤—Ä–æ–≤ —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–æ–≥–æ –∏–º–ø—Ä–µ—Å—Å–∏–æ–Ω–∏–∑–º–∞.",
   ticket_types:[{id:11,name:"–í–∑—Ä–æ—Å–ª—ã–π",price:800,available:300,total:500},{id:12,name:"–õ—å–≥–æ—Ç–Ω—ã–π",price:400,available:100,total:200}]},
];
const DEMO_STATS={users:1284,orders:847,revenue:3240500,tickets:1893};
const DEMO_PROMOS=[
  {code:"SUMMER25",type:"percent",value:25,used:14,max:100},
  {code:"VIP500",type:"fixed",value:500,used:3,max:10},
  {code:"WELCOME",type:"percent",value:10,used:87,max:200},
];
const CAT={all:"üåê –í—Å–µ",concert:"üéµ –ö–æ–Ω—Ü–µ—Ä—Ç—ã",theater:"üé≠ –¢–µ–∞—Ç—Ä",sport:"‚öΩ –°–ø–æ—Ä—Ç",exhibition:"üñº –í—ã—Å—Ç–∞–≤–∫–∏",festival:"üé™ –§–µ—Å—Ç–∏–≤–∞–ª–∏",other:"üé° –î—Ä—É–≥–æ–µ"};

// ‚îÄ‚îÄ –¢–û–ê–°–¢ ‚îÄ‚îÄ
function toast(msg,type=''){
  const el=document.getElementById('toast');
  el.textContent=msg; el.className=`toast ${type} show`;
  setTimeout(()=>el.classList.remove('show'),2600);
}

// ‚îÄ‚îÄ RIPPLE ‚îÄ‚îÄ
document.addEventListener('click',e=>{
  const t=e.target.closest('.btn,.role-card,.ev-card,.tt-card,.hbtn');
  if(!t) return;
  const r=document.createElement('span'); r.className='ripple-el';
  const rc=t.getBoundingClientRect(), sz=Math.max(rc.width,rc.height);
  r.style.cssText=`width:${sz}px;height:${sz}px;left:${e.clientX-rc.left-sz/2}px;top:${e.clientY-rc.top-sz/2}px`;
  t.appendChild(r); setTimeout(()=>r.remove(),600);
});

// ‚îÄ‚îÄ –°–¢–†–ê–ù–ò–¶–´ ‚îÄ‚îÄ
function pg(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.add('off'));
  const p=document.getElementById(id); p.classList.remove('off');
  p.style.transition='none'; p.style.opacity='0'; p.style.transform='translateX(16px)';
  requestAnimationFrame(()=>requestAnimationFrame(()=>{
    p.style.transition='opacity .28s,transform .28s';
    p.style.opacity='1'; p.style.transform='translateX(0)';
  }));
}

// ‚îÄ‚îÄ –†–û–õ–¨ ‚îÄ‚îÄ
function chooseRole(r){
  haptic?.selectionChanged();
  role=r; localStorage.setItem('tg_role',r);
  if(r==='buyer'){ loadEvents(); pg('pgBuyer'); }
  else { pg('pgSeller'); renderStats(); }
}
function switchRole(){
  haptic?.selectionChanged();
  role=role==='buyer'?'seller':'buyer';
  localStorage.setItem('tg_role',role);
  if(role==='buyer') pg('pgBuyer');
  else { pg('pgSeller'); renderStats(); }
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
(()=>{
  role=localStorage.getItem('tg_role')||'';
  if(role) chooseRole(role); else pg('pgOnboard');
  updBadge();
})();

// ‚îÄ‚îÄ –ó–ê–ì–†–£–ó–ö–ê –°–û–ë–´–¢–ò–ô ‚îÄ‚îÄ
async function loadEvents(){
  renderSkel();
  try{
    const r=await fetch(`${API}/api/events`,{headers:{'X-User-Id':UID||''}});
    if(!r.ok) throw 0; allEvs=await r.json();
  }catch{ allEvs=DEMO_EVTS; }
  renderChips(); renderEvents();
}

// ‚îÄ‚îÄ –ß–ò–ü–°–´ ‚îÄ‚îÄ
function renderChips(){
  const cats=['all',...new Set(allEvs.map(e=>e.category))];
  document.getElementById('chipsBar').innerHTML=cats.map(c=>`
    <div class="chip ${c===curFilter?'on':''}" onclick="setFilter('${c}')">${CAT[c]||c}</div>`).join('');
}
function setFilter(c){ curFilter=c; haptic?.selectionChanged(); renderChips(); filterEvents(); }
function filterEvents(){
  const q=document.getElementById('searchInput').value.toLowerCase();
  const f=allEvs.filter(e=>(curFilter==='all'||e.category===curFilter)&&(!q||e.title.toLowerCase().includes(q)||e.city.toLowerCase().includes(q)));
  renderEvents(f);
}

// ‚îÄ‚îÄ –°–û–ë–´–¢–ò–Ø ‚îÄ‚îÄ
function renderSkel(){
  document.getElementById('evList').innerHTML=`<div class="ev-list">${[1,2,3].map(i=>`
    <div class="ev-card" style="animation-delay:${i*.1}s">
      <div class="ev-inner">
        <div class="ev-poster skel" style="min-height:108px;width:88px"></div>
        <div class="ev-body" style="gap:9px">
          ${[60,90,70,50].map(w=>`<div class="skel" style="height:10px;width:${w}%"></div>`).join('')}
        </div>
      </div>
    </div>`).join('')}</div>`;
}
function renderEvents(evs=allEvs){
  const el=document.getElementById('evList');
  if(!evs.length){ el.innerHTML=`<div class="empty"><div class="empty-ico">üîç</div><div>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div></div>`; return; }
  el.innerHTML=`<div class="ev-list">${evs.map((ev,i)=>{
    const mp=Math.min(...ev.ticket_types.map(t=>t.price));
    const ts=ev.ticket_types.reduce((s,t)=>s+t.available,0);
    const low=ts<=20;
    return`<div class="ev-card au" style="animation-delay:${i*.05}s" onclick="openDetail(${ev.id})">
      <div class="ev-inner">
        <div class="ev-poster">${ev.poster_url?`<img src="${ev.poster_url}" loading="lazy">`:''}<span class="ev-poster-e">${ev.emoji||'üé°'}</span></div>
        <div class="ev-body">
          <div class="ev-cat">${CAT[ev.category]||ev.category}</div>
          <div class="ev-title">${ev.title}</div>
          <div class="ev-meta">üìÖ ${ev.date} ¬∑ ${ev.time}</div>
          <div class="ev-meta">üìç ${ev.venue}, ${ev.city}</div>
          <div class="ev-foot">
            <div class="ev-price">–æ—Ç ${mp.toLocaleString('ru')} ‚ÇΩ</div>
            <div class="seats-tag ${low?'low':''}">${low?'üî• ':''}${ts} –º–µ—Å—Ç</div>
          </div>
        </div>
      </div>
    </div>`;
  }).join('')}</div>`;
}

// ‚îÄ‚îÄ –î–ï–¢–ê–õ–ò ‚îÄ‚îÄ
function openDetail(id){
  curEv=allEvs.find(e=>e.id===id); if(!curEv) return;
  selTT=null; qty=1;
  document.getElementById('dEmoji').textContent=curEv.emoji||'üé°';
  document.getElementById('dCat').textContent=CAT[curEv.category]||curEv.category;
  document.getElementById('dTitle').textContent=curEv.title;
  document.getElementById('qtyN').textContent='1';
  const dd=document.getElementById('dDesc');
  if(curEv.description){ dd.style.display='block'; dd.textContent=curEv.description; } else dd.style.display='none';
  document.getElementById('dGrid').innerHTML=`
    <div class="ib"><div class="ib-l">üìÖ –î–∞—Ç–∞</div><div class="ib-v">${curEv.date}</div></div>
    <div class="ib"><div class="ib-l">üïê –í—Ä–µ–º—è</div><div class="ib-v">${curEv.time}</div></div>
    <div class="ib"><div class="ib-l">üìç –ú–µ—Å—Ç–æ</div><div class="ib-v">${curEv.venue}</div></div>
    <div class="ib"><div class="ib-l">üîû –í–æ–∑—Ä–∞—Å—Ç</div><div class="ib-v">${curEv.age_rating}</div></div>`;
  document.getElementById('ttList').innerHTML=curEv.ticket_types.map(tt=>{
    const so=tt.available===0, low=tt.available>0&&tt.available<=10;
    return`<div class="tt-card ${so?'so':''}" id="tt${tt.id}" onclick="${so?'':(`selTT(${tt.id})`)}">
      <div><div class="tt-nm">${tt.name}${low?`<span class="badge-tag">–ú–∞–ª–æ</span>`:''}</div>
      <div class="tt-av ${low?'low':''}">${so?'–ù–µ—Ç –º–µ—Å—Ç':`${tt.available}/${tt.total} –º–µ—Å—Ç`}</div></div>
      <div style="display:flex;align-items:center">
        <div class="tt-pr">${tt.price.toLocaleString('ru')} ‚ÇΩ</div>
        <div class="tt-rd" id="rd${tt.id}">${so?'‚úï':''}</div>
      </div>
    </div>`;
  }).join('');
  updAddBtn(); haptic?.selectionChanged(); pg('pgDetail');
}
function goBack(){ pg('pgBuyer'); }
function selectTicketType(id){
  const ev=curEv; selectedTT=ev.ticket_types.find(t=>t.id===id);
  ev.ticket_types.forEach(t=>{ document.getElementById(`tt${t.id}`)?.classList.remove('sel'); const r=document.getElementById(`rd${t.id}`); if(r) r.textContent=''; });
  document.getElementById(`tt${id}`)?.classList.add('sel');
  document.getElementById(`rd${id}`).textContent='‚úì';
  qty=1; document.getElementById('qtyN').textContent='1';
  haptic?.selectionChanged(); updAddBtn();
}
function chQty(d){
  if(!selectedTT) return;
  qty=Math.max(1,Math.min(Math.min(selectedTT.available,8),qty+d));
  document.getElementById('qtyN').textContent=qty;
  haptic?.selectionChanged(); updAddBtn();
}
function updAddBtn(){
  const b=document.getElementById('addBtn');
  if(!selectedTT){ b.textContent='–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –±–∏–ª–µ—Ç–∞'; b.disabled=true; }
  else{ b.textContent=`üõí –í –∫–æ—Ä–∑–∏–Ω—É ‚Äî ${(selectedTT.price*qty).toLocaleString('ru')} ‚ÇΩ`; b.disabled=false; }
}

// ‚îÄ‚îÄ –ö–û–†–ó–ò–ù–ê ‚îÄ‚îÄ
function addCart(){
  if(!selectedTT||!curEv) return;
  const ex=cart.find(c=>c.tt_id===selectedTT.id);
  if(ex) ex.qty=Math.min(ex.qty+qty,8);
  else cart.push({event_id:curEv.id,event_title:curEv.title,event_date:curEv.date,event_time:curEv.time,event_age:curEv.age_rating,venue:curEv.venue,tt_id:selectedTT.id,tt_name:selectedTT.name,price:selectedTT.price,qty});
  saveCart(); haptic?.notificationOccurred('success');
  toast('‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É!','ok');
  pg('pgBuyer');
}
function saveCart(){ localStorage.setItem('tg_cart',JSON.stringify(cart)); updBadge(); }
function updBadge(){
  const tot=cart.reduce((s,i)=>s+i.qty,0);
  const b=document.getElementById('cartBadge');
  if(b){ b.textContent=tot; b.classList.toggle('on',tot>0); }
  const bb=document.getElementById('buyerBBar');
  if(bb) bb.style.display=cart.length?'block':'none';
  const cs=document.getElementById('cartSum');
  if(cs){ const s=cart.reduce((sum,i)=>sum+i.price*i.qty,0); cs.textContent=s>0?`${s.toLocaleString('ru')} ‚ÇΩ`:''; }
}
function openCart(){ renderCart(); document.getElementById('shCart').classList.add('on'); }
function closeCart(){ document.getElementById('shCart').classList.remove('on'); }
function delCart(ttId){ cart=cart.filter(i=>i.tt_id!==ttId); saveCart(); renderCart(); haptic?.selectionChanged(); }
function renderCart(){
  const c=document.getElementById('cartContent'), btn=document.getElementById('checkoutBtn');
  if(!cart.length){
    c.innerHTML=`<div class="empty"><div class="empty-ico">üõí</div><div>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div></div>`;
    btn.disabled=true; btn.textContent='–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞'; return;
  }
  const tot=cart.reduce((s,i)=>s+i.price*i.qty,0);
  btn.disabled=false; btn.textContent=`üí≥ –û—Ñ–æ—Ä–º–∏—Ç—å ‚Äî ${tot.toLocaleString('ru')} ‚ÇΩ`;
  c.innerHTML=cart.map(it=>`
    <div class="cart-item">
      <div class="ci-title">${it.event_title}</div>
      <div class="ci-sub">üé´ ${it.tt_name} √ó ${it.qty} —à—Ç &nbsp;|&nbsp; üìÖ ${it.event_date} ${it.event_time}</div>
      <div class="ci-foot">
        <div class="ci-price">${(it.price*it.qty).toLocaleString('ru')} ‚ÇΩ</div>
        <button class="btn btn-danger btn-sm" onclick="delCart(${it.tt_id})">‚úï –£–±—Ä–∞—Ç—å</button>
      </div>
    </div>`).join('')+
  `<div class="total-row"><span class="total-lbl">–ò—Ç–æ–≥–æ</span><span class="total-val">${tot.toLocaleString('ru')} ‚ÇΩ</span></div>`;
}

// ‚îÄ‚îÄ –û–§–û–†–ú–õ–ï–ù–ò–ï ‚îÄ‚îÄ
async function checkout(){
  if(!cart.length) return;
  const btn=document.getElementById('checkoutBtn');
  btn.disabled=true; btn.innerHTML='<div class="loader"></div>';
  haptic?.selectionChanged();
  lastOrderTickets=[...cart];
  try{
    const r=await fetch(`${API}/api/order`,{method:'POST',
      headers:{'Content-Type':'application/json','X-User-Id':UID||'','X-Init-Data':tg?.initData||''},
      body:JSON.stringify({items:cart,user_id:UID})});
    if(!r.ok) throw 0;
  }catch{}
  cart=[]; saveCart();
  closeCart();
  setTimeout(()=>{ document.getElementById('shSuccess').classList.add('on'); haptic?.notificationOccurred('success'); },300);
}

// ‚îÄ‚îÄ –£–°–ü–ï–• ‚îÄ‚îÄ
function viewTickets(){
  document.getElementById('shSuccess').classList.remove('on');
  if(lastOrderTickets.length>0) showTicket(lastOrderTickets[0]);
}
function closeSuccess(){ document.getElementById('shSuccess').classList.remove('on'); pg('pgBuyer'); }

// ‚îÄ‚îÄ –ë–ò–õ–ï–¢ (PDF-—Å—Ç–∏–ª—å) ‚îÄ‚îÄ
function showTicket(item){
  const ev=allEvs.find(e=>e.id===item.event_id)||{title:item.event_title,date:item.event_date,time:item.event_time,venue:item.venue,age_rating:item.event_age||'0+'};
  const qrId=`TKT-${Date.now()}-${Math.random().toString(36).substr(2,6).toUpperCase()}`;
  document.getElementById('tEvName').textContent=item.event_title;
  document.getElementById('tDate').textContent=`${item.event_date} –≤ ${item.event_time}`;
  document.getElementById('tVenue').textContent=`${item.venue}`;
  document.getElementById('tAge').textContent=item.event_age||ev.age_rating||'0+';
  document.getElementById('tType').textContent=item.tt_name;
  document.getElementById('tId').textContent=`ID: ${qrId}`;
  const qrEl=document.getElementById('ticketQR'); qrEl.innerHTML='';
  new QRCode(qrEl,{text:qrId,width:74,height:74,colorDark:'#0f0f1a',colorLight:'#ffffff',correctLevel:QRCode.CorrectLevel.H});
  pg('pgTicket');
}

function downloadTicket(){
  haptic?.notificationOccurred('success');
  toast('üì• –°–∫–∞—á–∏–≤–∞–Ω–∏–µ... –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" –≤ –±—Ä–∞—É–∑–µ—Ä–µ','ok');
  // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –≤—ã–∑–≤–∞—Ç—å window.print() –∏–ª–∏ jsPDF
  window.print();
}
function showSuccess(){ pg('pgBuyer'); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –ü–†–û–î–ê–í–ï–¶ ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function selTab(tab){
  curSelTab=tab;
  document.querySelectorAll('.sel-tab').forEach((el,i)=>el.classList.toggle('on',['stats','events','scan','promo'][i]===tab));
  haptic?.selectionChanged();
  if(tab==='stats')  renderStats();
  if(tab==='events') renderAddEvent();
  if(tab==='scan')   renderScanner();
  if(tab==='promo')  renderPromos();
}

// ‚îÄ‚îÄ –°–¢–ê–¢–ò–°–¢–ò–ö–ê ‚îÄ‚îÄ
async function renderStats(){
  const c=document.getElementById('selContent');
  c.innerHTML=`<div style="display:flex;align-items:center;justify-content:center;padding:40px"><div class="loader"></div></div>`;
  let stats=DEMO_STATS, evs=DEMO_EVTS;
  try{
    const rs=await fetch(`${API}/api/admin/stats`,{headers:{'X-User-Id':UID||''}}); if(rs.ok) stats=await rs.json();
    const re=await fetch(`${API}/api/events`,{headers:{'X-User-Id':UID||''}}); if(re.ok) evs=await re.json();
  }catch{}
  c.innerHTML=`
    <div class="stat-grid">
      ${[['üë•','users','–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π'],['üõí','orders','–ó–∞–∫–∞–∑–æ–≤'],['üéü','tickets','–ë–∏–ª–µ—Ç–æ–≤ –≤—ã–¥–∞–Ω–æ']].map((s,i)=>`
      <div class="stat-card au" style="animation-delay:${i*.07}s">
        <div class="st-ico">${s[0]}</div>
        <div class="st-val">${stats[s[1]].toLocaleString('ru')}</div>
        <div class="st-lbl">${s[2]}</div>
      </div>`).join('')}
      <div class="stat-card au" style="animation-delay:.21s">
        <div class="st-ico">üí∞</div>
        <div class="st-val">${Math.floor(stats.revenue/1000)}K</div>
        <div class="st-lbl">–í—ã—Ä—É—á–∫–∞ ‚ÇΩ</div>
      </div>
    </div>
    <div class="sec">üìÖ –ú–æ–∏ —Å–æ–±—ã—Ç–∏—è</div>
    ${evs.map((ev,i)=>{
      const sold=ev.ticket_types.reduce((s,t)=>s+(t.total-t.available),0);
      const tot=ev.ticket_types.reduce((s,t)=>s+t.total,0);
      const pct=tot>0?Math.round(sold/tot*100):0;
      const rev=ev.ticket_types.reduce((s,t)=>s+(t.total-t.available)*t.price,0);
      return`<div class="cart-item au" style="animation-delay:${.1+i*.05}s">
        <div class="ci-title">${ev.emoji||'üé°'} ${ev.title}</div>
        <div class="ci-sub">üìÖ ${ev.date} ¬∑ üìç ${ev.venue}</div>
        <div class="prog-bar"><div class="prog-fill" style="width:${pct}%"></div></div>
        <div class="ci-foot">
          <span style="font-size:10px;color:var(--muted)">–ü—Ä–æ–¥–∞–Ω–æ ${sold}/${tot} (${pct}%)</span>
          <span style="font-size:11px;color:var(--green);font-weight:700">${rev.toLocaleString('ru')} ‚ÇΩ</span>
        </div>
      </div>`;}).join('')}`;
}

// ‚îÄ‚îÄ –î–û–ë–ê–í–ò–¢–¨ –°–û–ë–´–¢–ò–ï ‚îÄ‚îÄ
function renderAddEvent(){
  document.getElementById('selContent').innerHTML=`
    <div class="sec">‚ûï –ù–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ</div>
    <div class="fld"><label class="fl">–ù–∞–∑–≤–∞–Ω–∏–µ</label><input class="fi" id="evT" placeholder="–ö–æ–Ω—Ü–µ—Ä—Ç Imagine Dragons"></div>
    <div class="fld"><label class="fl">–û–ø–∏—Å–∞–Ω–∏–µ</label><input class="fi" id="evD" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ..."></div>
    <div class="frow">
      <div class="fld"><label class="fl">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <select class="fi" id="evC">
          <option value="concert">üéµ –ö–æ–Ω—Ü–µ—Ä—Ç</option><option value="theater">üé≠ –¢–µ–∞—Ç—Ä</option>
          <option value="sport">‚öΩ –°–ø–æ—Ä—Ç</option><option value="exhibition">üñº –í—ã—Å—Ç–∞–≤–∫–∞</option>
          <option value="festival">üé™ –§–µ—Å—Ç–∏–≤–∞–ª—å</option><option value="other">üé° –î—Ä—É–≥–æ–µ</option>
        </select>
      </div>
      <div class="fld"><label class="fl">–í–æ–∑—Ä–∞—Å—Ç</label>
        <select class="fi" id="evA"><option>0+</option><option>6+</option><option>12+</option><option>16+</option><option>18+</option></select>
      </div>
    </div>
    <div class="fld"><label class="fl">–ü–ª–æ—â–∞–¥–∫–∞</label><input class="fi" id="evV" placeholder="–û–ª–∏–º–ø–∏–π—Å–∫–∏–π"></div>
    <div class="frow">
      <div class="fld"><label class="fl">–ì–æ—Ä–æ–¥</label><input class="fi" id="evCi" placeholder="–ú–æ—Å–∫–≤–∞"></div>
      <div class="fld"><label class="fl">–î–∞—Ç–∞</label><input class="fi" type="date" id="evDt"></div>
    </div>
    <div class="fld"><label class="fl">–í—Ä–µ–º—è</label><input class="fi" type="time" id="evTm" value="19:00"></div>
    <div class="sec" style="margin-top:12px">üé´ –¢–∏–ø –±–∏–ª–µ—Ç–∞</div>
    <div class="fld"><label class="fl">–ù–∞–∑–≤–∞–Ω–∏–µ (–°—Ç–∞–Ω–¥–∞—Ä—Ç, VIP...)</label><input class="fi" id="ttN" placeholder="–°—Ç–∞–Ω–¥–∞—Ä—Ç"></div>
    <div class="frow">
      <div class="fld"><label class="fl">–¶–µ–Ω–∞ ‚ÇΩ</label><input class="fi" type="number" id="ttP" placeholder="2000"></div>
      <div class="fld"><label class="fl">–ú–µ—Å—Ç</label><input class="fi" type="number" id="ttS" placeholder="100"></div>
    </div>
    <button class="btn btn-primary" id="submitEvBtn" onclick="submitEvent()" style="margin-top:8px">‚úÖ –°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ</button>
    <div style="height:20px"></div>`;
}

async function submitEvent(){
  const d={
    title:document.getElementById('evT').value.trim(),
    description:document.getElementById('evD').value.trim(),
    category:document.getElementById('evC').value,
    age_rating:document.getElementById('evA').value,
    venue:document.getElementById('evV').value.trim(),
    city:document.getElementById('evCi').value.trim(),
    date:document.getElementById('evDt').value,
    time:document.getElementById('evTm').value,
    tt_name:document.getElementById('ttN').value.trim(),
    tt_price:parseFloat(document.getElementById('ttP').value),
    tt_seats:parseInt(document.getElementById('ttS').value),
  };
  if(!d.title||!d.venue||!d.city||!d.date||!d.tt_name||!d.tt_price||!d.tt_seats){ toast('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è','err'); return; }
  const btn=document.getElementById('submitEvBtn');
  btn.disabled=true; btn.innerHTML='<div class="loader"></div>';
  try{
    const r=await fetch(`${API}/api/admin/event`,{method:'POST',headers:{'Content-Type':'application/json','X-User-Id':UID||''},body:JSON.stringify(d)});
    if(!r.ok) throw 0;
  }catch{}
  haptic?.notificationOccurred('success');
  toast('‚úÖ –°–æ–±—ã—Ç–∏–µ —Å–æ–∑–¥–∞–Ω–æ! –ë–æ—Ç –æ–±–Ω–æ–≤–∏—Ç –¥–∞–Ω–Ω—ã–µ.','ok');
  renderAddEvent();
}

// ‚îÄ‚îÄ –°–ö–ê–ù–ï–† ‚îÄ‚îÄ
function renderScanner(){
  document.getElementById('selContent').innerHTML=`
    <div class="sec">üì∑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∏–ª–µ—Ç</div>
    <div class="scanner-box" id="scanBox">
      <div style="font-size:52px;margin-bottom:10px">üì∑</div>
      <div style="font-weight:700;margin-bottom:5px">–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –±–∏–ª–µ—Ç–∞</div>
      <div style="font-size:11px;color:var(--muted)">–í—Å—Ç–∞–≤—å—Ç–µ UUID –∏–∑ QR-–∫–æ–¥–∞</div>
    </div>
    <div id="scanRes"></div>
    <div class="fld"><label class="fl">–ö–æ–¥ –±–∏–ª–µ—Ç–∞ (UUID)</label><input class="fi" id="qrIn" placeholder="TKT-xxxxxxxx-xxxx"></div>
    <button class="btn btn-primary" onclick="validateTkt()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∏–ª–µ—Ç</button>`;
}

async function validateTkt(){
  const code=document.getElementById('qrIn').value.trim();
  if(!code){ toast('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥','err'); return; }
  const btn=document.querySelector('#selContent .btn-primary');
  btn.disabled=true; btn.innerHTML='<div class="loader"></div>';
  let res=null;
  try{
    const r=await fetch(`${API}/api/admin/validate`,{method:'POST',headers:{'Content-Type':'application/json','X-User-Id':UID||''},body:JSON.stringify({qr_code:code})});
    if(r.ok) res=await r.json();
  }catch{}
  btn.disabled=false; btn.textContent='üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∏–ª–µ—Ç';
  if(!res) res=code.length>8?{status:'valid',event:'Imagine Dragons Live',ticket_type:'–°—Ç–∞–Ω–¥–∞—Ä—Ç',date:'15.06.2025 19:00',venue:'–û–ª–∏–º–ø–∏–π—Å–∫–∏–π'}:{status:'invalid'};
  const el=document.getElementById('scanRes');
  if(res.status==='valid'){
    haptic?.notificationOccurred('success');
    el.innerHTML=`<div class="scan-res ok"><div style="font-weight:700;margin-bottom:6px">‚úÖ –ë–ò–õ–ï–¢ –î–ï–ô–°–¢–í–ò–¢–ï–õ–ï–ù</div>
      <div style="font-size:12px;color:var(--muted)">üé≠ ${res.event}</div>
      <div style="font-size:12px;color:var(--muted)">üé´ ${res.ticket_type}</div>
      <div style="font-size:12px;color:var(--muted)">üìÖ ${res.date}</div></div>`;
    toast('‚úÖ –ë–∏–ª–µ—Ç –ø—Ä–∏–Ω—è—Ç!','ok');
  }else if(res.status==='used'){
    haptic?.notificationOccurred('error');
    el.innerHTML=`<div class="scan-res used"><div style="font-weight:700">‚õî –£–ñ–ï –ò–°–ü–û–õ–¨–ó–û–í–ê–ù</div></div>`;
    toast('‚õî –ë–∏–ª–µ—Ç —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω','err');
  }else{
    haptic?.notificationOccurred('error');
    el.innerHTML=`<div class="scan-res bad"><div style="font-weight:700">‚ùå –ë–ò–õ–ï–¢ –ù–ï –ù–ê–ô–î–ï–ù</div></div>`;
    toast('‚ùå –ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –±–∏–ª–µ—Ç','err');
  }
  document.getElementById('qrIn').value='';
}

// ‚îÄ‚îÄ –ü–†–û–ú–û–ö–û–î–´ ‚îÄ‚îÄ
function renderPromos(){
  document.getElementById('selContent').innerHTML=`
    <div class="sec">üè∑ –ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã</div>
    ${DEMO_PROMOS.map((p,i)=>`
      <div class="promo-card au" style="animation-delay:${i*.07}s">
        <div>
          <div class="pc">${p.code}</div>
          <div class="pi">${p.type==='percent'?`‚àí${p.value}%`:`‚àí${p.value} ‚ÇΩ`} &nbsp;¬∑&nbsp; ${p.used}/${p.max} –∏—Å–ø.</div>
        </div>
        <div style="width:60px">
          <div class="prog-bar"><div class="prog-fill" style="width:${Math.round(p.used/p.max*100)}%"></div></div>
          <div style="font-size:9px;color:var(--muted);text-align:right">${Math.round(p.used/p.max*100)}%</div>
        </div>
      </div>`).join('')}
    <div class="sec" style="margin-top:14px">‚ûï –ù–æ–≤—ã–π –ø—Ä–æ–º–æ–∫–æ–¥</div>
    <div class="fld"><label class="fl">–ö–æ–¥</label><input class="fi" id="pcC" placeholder="SUMMER25" oninput="this.value=this.value.toUpperCase()"></div>
    <div class="frow">
      <div class="fld"><label class="fl">–¢–∏–ø</label>
        <select class="fi" id="pcT"><option value="percent">% –ü—Ä–æ—Ü–µ–Ω—Ç</option><option value="fixed">‚ÇΩ –°—É–º–º–∞</option></select>
      </div>
      <div class="fld"><label class="fl">–†–∞–∑–º–µ—Ä</label><input class="fi" type="number" id="pcV" placeholder="25"></div>
    </div>
    <div class="fld"><label class="fl">–ú–∞–∫—Å. –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π</label><input class="fi" type="number" id="pcM" placeholder="100"></div>
    <button class="btn btn-primary" onclick="createPromo()" style="margin-top:4px">‚úÖ –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</button>
    <div style="height:20px"></div>`;
}

async function createPromo(){
  const code=document.getElementById('pcC').value.trim().toUpperCase();
  const type=document.getElementById('pcT').value;
  const val=parseFloat(document.getElementById('pcV').value);
  const max=parseInt(document.getElementById('pcM').value);
  if(!code||!val||!max){ toast('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è','err'); return; }
  try{
    await fetch(`${API}/api/admin/promo`,{method:'POST',headers:{'Content-Type':'application/json','X-User-Id':UID||''},body:JSON.stringify({code,type,value:val,max_uses:max})});
  }catch{}
  haptic?.notificationOccurred('success');
  toast(`‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥ ${code} —Å–æ–∑–¥–∞–Ω!`,'ok');
  renderPromos();
}
</script>
</body>
</html>
