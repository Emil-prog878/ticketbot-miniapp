<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>TicketBot</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;600;800&family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#080812;--bg2:#10101f;--bg3:#18182e;--bg4:#22223a;
  --accent:#7c3aed;--a2:#a855f7;--gold:#f59e0b;
  --green:#10b981;--red:#ef4444;--txt:#f0f0ff;--muted:#6b6b9a;--bdr:#2a2a4a;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden}
body{font-family:'Manrope',sans-serif;background:var(--bg);color:var(--txt);font-size:14px}

@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes pop{0%{transform:scale(0)}70%{transform:scale(1.12)}100%{transform:scale(1)}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-7px)}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}
@keyframes rpl{to{transform:scale(4);opacity:0}}
@keyframes glow{0%,100%{box-shadow:0 0 15px rgba(124,58,237,.3)}50%{box-shadow:0 0 40px rgba(124,58,237,.65)}}

/* Ğ¡Ğ¢Ğ ĞĞĞ˜Ğ¦Ğ« */
.page{position:fixed;inset:0;display:flex;flex-direction:column;background:var(--bg);z-index:10;transition:opacity .25s,transform .25s}
.page.hide{opacity:0;pointer-events:none;transform:translateX(16px)}

/* ĞšĞĞĞŸĞšĞ˜ */
.btn{position:relative;overflow:hidden;display:inline-flex;align-items:center;justify-content:center;gap:7px;border:none;border-radius:13px;cursor:pointer;font-family:'Manrope',sans-serif;font-weight:700;font-size:14px;padding:13px 18px;transition:transform .13s,opacity .13s,box-shadow .2s;width:100%}
.btn:active{transform:scale(.96);opacity:.88}
.btn:disabled{opacity:.4;cursor:not-allowed;transform:none!important}
.bp{background:linear-gradient(135deg,var(--accent),var(--a2));color:#fff}
.bp:not(:disabled):hover{box-shadow:0 6px 28px rgba(124,58,237,.4)}
.bs{background:var(--bg3);color:var(--txt);border:1px solid var(--bdr)}
.bd{background:rgba(239,68,68,.1);color:var(--red);border:1px solid rgba(239,68,68,.25)}
.bsm{padding:7px 12px;font-size:12px;border-radius:10px;width:auto}
.rpl-el{position:absolute;border-radius:50%;background:rgba(255,255,255,.22);transform:scale(0);animation:rpl .55s linear;pointer-events:none}

/* Ğ¥Ğ•Ğ”Ğ•Ğ  */
.hdr{padding:10px 14px 8px;background:rgba(8,8,18,.93);backdrop-filter:blur(20px);border-bottom:1px solid var(--bdr);flex-shrink:0}
.hdr-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.logo{font-family:'Unbounded',sans-serif;font-size:15px;font-weight:800;background:linear-gradient(135deg,var(--a2),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hbtns{display:flex;gap:7px}
.hbtn{background:var(--bg3);border:1px solid var(--bdr);border-radius:11px;padding:7px 11px;color:var(--txt);font-size:13px;cursor:pointer;transition:all .18s;position:relative;white-space:nowrap}
.hbtn:active{transform:scale(.92)}
.hbadge{position:absolute;top:-5px;right:-5px;background:var(--accent);color:#fff;font-size:9px;font-weight:700;border-radius:99px;padding:2px 5px;min-width:17px;text-align:center;display:none;border:2px solid var(--bg)}
.hbadge.on{display:block;animation:pop .3s ease}

/* ĞŸĞĞ˜Ğ¡Ğš Ğ˜ Ğ§Ğ˜ĞŸĞ¡Ğ« */
.srch{position:relative;margin-bottom:7px}
.srch input{width:100%;background:var(--bg3);border:1.5px solid var(--bdr);border-radius:12px;padding:8px 12px 8px 35px;color:var(--txt);font-family:'Manrope',sans-serif;font-size:12px;outline:none;transition:border-color .2s}
.srch input:focus{border-color:var(--accent)}
.srch input::placeholder{color:var(--muted)}
.srch-ic{position:absolute;left:11px;top:50%;transform:translateY(-50%);font-size:13px;color:var(--muted);pointer-events:none}
.chips{display:flex;gap:7px;overflow-x:auto;scrollbar-width:none;padding-bottom:1px}
.chips::-webkit-scrollbar{display:none}
.chip{flex-shrink:0;background:var(--bg3);border:1px solid var(--bdr);border-radius:99px;padding:5px 12px;color:var(--muted);font-size:11px;font-weight:600;cursor:pointer;transition:all .18s;white-space:nowrap}
.chip.on{background:var(--accent);border-color:var(--accent);color:#fff;transform:scale(1.04)}

/* Ğ¡ĞšĞ ĞĞ›Ğ› */
.scr{flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;padding:12px;padding-bottom:88px}
.scr::-webkit-scrollbar{display:none}

/* ĞĞ˜Ğ–ĞĞ˜Ğ™ Ğ‘ĞĞ  */
.bbar{padding:9px 13px max(env(safe-area-inset-bottom),9px);background:rgba(8,8,18,.95);backdrop-filter:blur(20px);border-top:1px solid var(--bdr);flex-shrink:0}

/* ĞĞĞ‘ĞĞ Ğ”Ğ˜ĞĞ“ */
#pgOnboard{align-items:center;justify-content:center;padding:32px 22px;text-align:center;background:radial-gradient(ellipse at 50% -5%,rgba(124,58,237,.22) 0%,transparent 65%),var(--bg)}
.ob-ico{font-size:78px;animation:float 3s ease-in-out infinite;display:block;margin-bottom:14px}
.ob-logo{font-family:'Unbounded',sans-serif;font-size:24px;font-weight:800;background:linear-gradient(135deg,var(--a2),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:6px}
.ob-sub{color:var(--muted);font-size:13px;line-height:1.6;margin-bottom:34px}
.role-cards{display:flex;flex-direction:column;gap:11px;width:100%;max-width:340px}
.rc{background:var(--bg2);border:2px solid var(--bdr);border-radius:19px;padding:17px 18px;cursor:pointer;text-align:left;display:flex;align-items:center;gap:14px;transition:all .22s cubic-bezier(.34,1.56,.64,1)}
.rc:active{transform:scale(.97)}
.rc.buyer:hover,.rc.buyer:focus{border-color:var(--green);background:rgba(16,185,129,.06);transform:translateY(-2px)}
.rc.seller:hover,.rc.seller:focus{border-color:var(--gold);background:rgba(245,158,11,.06);transform:translateY(-2px)}
.rc-ico{font-size:36px;flex-shrink:0}
.rc-title{font-family:'Unbounded',sans-serif;font-size:13px;font-weight:700;margin-bottom:3px}
.rc-desc{font-size:11px;color:var(--muted)}
.rc-arr{color:var(--muted);font-size:17px;margin-left:auto;transition:transform .2s}
.rc:hover .rc-arr{transform:translateX(4px);color:var(--txt)}

/* ĞšĞĞ Ğ¢ĞĞ§ĞšĞ˜ Ğ¡ĞĞ‘Ğ«Ğ¢Ğ˜Ğ™ */
.ev-list{display:flex;flex-direction:column;gap:9px}
.ev-card{background:var(--bg2);border:1.5px solid var(--bdr);border-radius:14px;overflow:hidden;cursor:pointer;transition:border-color .2s,transform .13s,box-shadow .2s;animation:fadeUp .3s ease both}
.ev-card:active{transform:scale(.985)}
.ev-card:hover{border-color:rgba(124,58,237,.4);box-shadow:0 4px 18px rgba(124,58,237,.1)}
.ev-inner{display:flex}
.ev-poster{width:88px;flex-shrink:0;background:var(--bg3);display:flex;align-items:center;justify-content:center;font-size:34px;min-height:106px;position:relative;overflow:hidden}
.ev-poster img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
.ev-pe{position:relative;z-index:1}
.ev-body{flex:1;padding:11px;display:flex;flex-direction:column;gap:4px}
.ev-cat{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--a2)}
.ev-title{font-family:'Unbounded',sans-serif;font-size:11px;font-weight:700;line-height:1.3}
.ev-meta{font-size:10px;color:var(--muted)}
.ev-foot{display:flex;align-items:center;justify-content:space-between;margin-top:3px}
.ev-price{font-family:'Unbounded',sans-serif;font-size:12px;font-weight:700;color:var(--green)}
.seat-tag{font-size:9px;font-weight:700;padding:2px 7px;border-radius:99px;background:var(--bg4);color:var(--muted)}
.seat-tag.low{color:var(--red);background:rgba(239,68,68,.1)}

/* Ğ”Ğ•Ğ¢ĞĞ›Ğ˜ Ğ¡ĞĞ‘Ğ«Ğ¢Ğ˜Ğ¯ */
#pgDetail{z-index:20}
.d-hero{height:185px;background:var(--bg3);display:flex;align-items:center;justify-content:center;font-size:66px;position:relative;overflow:hidden;flex-shrink:0}
.d-hero::after{content:'';position:absolute;bottom:0;left:0;right:0;height:65px;background:linear-gradient(transparent,var(--bg))}
.d-hero img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
.d-he{position:relative;z-index:1}
.back-btn{position:absolute;top:12px;left:12px;z-index:10;background:rgba(0,0,0,.55);backdrop-filter:blur(8px);border:none;border-radius:99px;color:#fff;font-size:13px;padding:7px 12px;cursor:pointer;display:flex;align-items:center;gap:4px;transition:background .2s}
.back-btn:active{background:rgba(0,0,0,.8)}
.d-cat{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--a2);margin-bottom:5px}
.d-title{font-family:'Unbounded',sans-serif;font-size:17px;font-weight:800;line-height:1.2;margin-bottom:12px}
.ig{display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-bottom:12px}
.ib{background:var(--bg2);border:1px solid var(--bdr);border-radius:11px;padding:9px}
.ibl{font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:.6px;margin-bottom:2px}
.ibv{font-size:12px;font-weight:600}
.d-desc{background:var(--bg2);border:1px solid var(--bdr);border-radius:11px;padding:11px;font-size:12px;line-height:1.6;color:var(--muted);margin-bottom:12px}
.sec{font-family:'Unbounded',sans-serif;font-size:10px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}

/* Ğ¢Ğ˜ĞŸĞ« Ğ‘Ğ˜Ğ›Ğ•Ğ¢ĞĞ’ */
.tt-list{display:flex;flex-direction:column;gap:7px;margin-bottom:12px}
.tt-card{background:var(--bg2);border:2px solid var(--bdr);border-radius:13px;padding:11px 13px;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:space-between}
.tt-card.active-tt{border-color:var(--accent)!important;background:rgba(124,58,237,.08)!important}
.tt-card.soldout{opacity:.4;cursor:not-allowed}
.tt-card:not(.soldout):active{transform:scale(.98)}
.tt-nm{font-weight:700;font-size:13px;margin-bottom:2px}
.tt-av{font-size:10px;color:var(--muted)}
.tt-av.low{color:var(--red)}
.tt-pr{font-family:'Unbounded',sans-serif;font-size:13px;font-weight:700;color:var(--green)}
.tt-rd{width:19px;height:19px;border-radius:50%;border:2px solid var(--bdr);display:flex;align-items:center;justify-content:center;font-size:10px;transition:all .18s;flex-shrink:0;margin-left:8px}
.tt-card.active-tt .tt-rd{background:var(--accent);border-color:var(--accent);color:#fff}
.qty-row{display:flex;align-items:center;justify-content:space-between;background:var(--bg2);border:1px solid var(--bdr);border-radius:13px;padding:11px 13px;margin-bottom:13px}
.qty-lbl{font-size:13px;font-weight:600}
.qty-ctrl{display:flex;align-items:center;gap:13px}
.qty-btn{width:28px;height:28px;border-radius:50%;border:none;background:var(--bg4);color:var(--txt);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .13s}
.qty-btn:active{background:var(--accent);transform:scale(.88)}
.qty-n{font-family:'Unbounded',sans-serif;font-size:18px;font-weight:700;min-width:22px;text-align:center}

/* ĞšĞĞ Ğ—Ğ˜ĞĞ SHEET */
.sh-wrap{position:fixed;inset:0;z-index:50;display:flex;flex-direction:column;justify-content:flex-end;pointer-events:none}
.sh-wrap.on{pointer-events:all}
.sh-ov{position:absolute;inset:0;background:rgba(0,0,0,.6);opacity:0;transition:opacity .28s}
.sh-wrap.on .sh-ov{opacity:1}
.sh-body{position:relative;z-index:1;background:var(--bg2);border-radius:22px 22px 0 0;border-top:1px solid var(--bdr);max-height:88vh;display:flex;flex-direction:column;transform:translateY(100%);transition:transform .33s cubic-bezier(.34,1.56,.64,1)}
.sh-wrap.on .sh-body{transform:translateY(0)}
.sh-handle{width:36px;height:4px;background:var(--bdr);border-radius:99px;margin:9px auto 0}
.sh-hdr{padding:11px 14px;border-bottom:1px solid var(--bdr);display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.sh-title{font-family:'Unbounded',sans-serif;font-size:14px;font-weight:700}
.sh-x{background:var(--bg3);border:1px solid var(--bdr);border-radius:99px;width:26px;height:26px;cursor:pointer;font-size:13px;display:flex;align-items:center;justify-content:center;transition:background .18s}
.sh-x:active{background:var(--bg4)}
.sh-scr{overflow-y:auto;flex:1;padding:11px}
.sh-scr::-webkit-scrollbar{display:none}
.sh-foot{padding:9px 13px max(env(safe-area-inset-bottom),9px);border-top:1px solid var(--bdr);flex-shrink:0}

/* Ğ­Ğ›Ğ•ĞœĞ•ĞĞ¢ ĞšĞĞ Ğ—Ğ˜ĞĞ« */
.ci{background:var(--bg3);border:1px solid var(--bdr);border-radius:13px;padding:11px;margin-bottom:7px;animation:fadeUp .22s ease both}
.ci-title{font-weight:700;font-size:13px;margin-bottom:2px}
.ci-sub{font-size:11px;color:var(--muted);margin-bottom:8px}
.ci-foot{display:flex;align-items:center;justify-content:space-between}
.ci-price{font-family:'Unbounded',sans-serif;font-size:13px;font-weight:700;color:var(--green)}
.total-row{display:flex;align-items:center;justify-content:space-between;padding:11px 0;border-top:1px solid var(--bdr);margin-top:3px}
.total-lbl{font-size:12px;color:var(--muted)}
.total-val{font-family:'Unbounded',sans-serif;font-size:20px;font-weight:800}

/* Ğ£Ğ¡ĞŸĞ•Ğ¥ SHEET */
#shSuccess .sh-body{background:linear-gradient(135deg,rgba(124,58,237,.14),rgba(168,85,247,.08)),var(--bg2);text-align:center;padding:28px 20px max(env(safe-area-inset-bottom),24px)}
.suc-ico{font-size:70px;display:block;margin-bottom:13px;animation:pop .45s .1s ease both}
.suc-title{font-family:'Unbounded',sans-serif;font-size:19px;font-weight:800;margin-bottom:7px}
.suc-sub{font-size:13px;color:var(--muted);line-height:1.6;margin-bottom:20px}

/* ĞŸĞ ĞĞ”ĞĞ’Ğ•Ğ¦ */
#pgSeller{z-index:10}
.sel-tabs{display:flex;background:var(--bg2);border-bottom:1px solid var(--bdr);flex-shrink:0;overflow-x:auto;scrollbar-width:none}
.sel-tabs::-webkit-scrollbar{display:none}
.s-tab{flex:1;min-width:68px;padding:11px 5px;text-align:center;font-size:10px;font-weight:600;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;transition:all .18s;white-space:nowrap}
.s-tab.on{color:var(--accent);border-bottom-color:var(--accent)}

/* Ğ¡Ğ¢ĞĞ¢Ğ˜Ğ¡Ğ¢Ğ˜ĞšĞ */
.stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:9px;margin-bottom:14px}
.stat-card{background:var(--bg2);border:1px solid var(--bdr);border-radius:14px;padding:13px;animation:fadeUp .3s ease both}
.st-ico{font-size:22px;margin-bottom:5px}
.st-val{font-family:'Unbounded',sans-serif;font-size:18px;font-weight:800;margin-bottom:1px}
.st-lbl{font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px}
.prog-bar{height:3px;background:var(--bg4);border-radius:99px;overflow:hidden;margin:6px 0 3px}
.prog-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--a2));border-radius:99px;transition:width .55s ease}

/* Ğ¤ĞĞ ĞœĞ */
.fld{margin-bottom:11px}
.fl{font-size:10px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px;display:block}
.fi{width:100%;background:var(--bg3);border:1.5px solid var(--bdr);border-radius:12px;padding:10px 13px;color:var(--txt);font-family:'Manrope',sans-serif;font-size:13px;outline:none;transition:border-color .2s;-webkit-appearance:none}
.fi:focus{border-color:var(--accent)}
.fi::placeholder{color:var(--muted)}
select.fi option{background:var(--bg2)}
textarea.fi{resize:vertical;min-height:70px}
.frow{display:grid;grid-template-columns:1fr 1fr;gap:9px}

/* ĞŸĞ ĞĞœĞ */
.promo-card{background:var(--bg2);border:1px solid var(--bdr);border-radius:13px;padding:11px 13px;margin-bottom:7px;display:flex;align-items:center;justify-content:space-between;animation:fadeUp .25s ease both}
.pc{font-family:'Unbounded',sans-serif;font-size:12px;font-weight:700;color:var(--a2)}
.pi{font-size:10px;color:var(--muted);margin-top:2px}

/* Ğ¡ĞšĞĞĞ•Ğ  */
.scan-box{background:var(--bg2);border:2px dashed var(--bdr);border-radius:18px;padding:26px 14px;text-align:center;margin-bottom:13px;transition:border-color .28s}
.scan-box.act{border-color:var(--accent);animation:glow 2s ease infinite}
.scan-res{background:var(--bg2);border-radius:13px;padding:13px;border:2px solid;margin-bottom:11px;animation:fadeUp .28s ease}
.scan-res.ok{border-color:var(--green)}.scan-res.used{border-color:var(--red)}.scan-res.bad{border-color:var(--muted)}

/* Ğ¡ĞšĞ•Ğ›Ğ•Ğ¢ĞĞ */
.skel{background:linear-gradient(90deg,var(--bg2) 25%,var(--bg3) 50%,var(--bg2) 75%);background-size:200% 100%;animation:shimmer 1.4s infinite;border-radius:8px}

/* Ğ¢ĞĞĞ¡Ğ¢ */
.toast{position:fixed;top:18px;left:50%;transform:translateX(-50%) translateY(-120px);background:var(--bg3);border:1px solid var(--bdr);border-radius:12px;padding:9px 16px;font-size:12px;font-weight:600;z-index:300;transition:transform .33s cubic-bezier(.34,1.56,.64,1);white-space:nowrap;box-shadow:0 8px 30px rgba(0,0,0,.5)}
.toast.show{transform:translateX(-50%) translateY(0)}
.toast.ok{border-color:var(--green);color:var(--green)}
.toast.err{border-color:var(--red);color:var(--red)}

/* Ğ›ĞĞĞ”Ğ•Ğ  */
.ld{width:18px;height:18px;border:2px solid rgba(255,255,255,.2);border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite}

/* ĞŸĞ£Ğ¡Ğ¢Ğ */
.empty{display:flex;flex-direction:column;align-items:center;padding:42px 14px;gap:9px;color:var(--muted);text-align:center}
.empty-ico{font-size:48px;animation:bounce 2s ease-in-out infinite}

.divider{height:1px;background:var(--bdr);margin:12px 0}
.tag-hot{display:inline-block;font-size:9px;font-weight:700;padding:1px 6px;border-radius:99px;background:var(--gold);color:#000;margin-left:5px}
.ev-mgmt-card{background:var(--bg2);border:1px solid var(--bdr);border-radius:13px;padding:12px;margin-bottom:8px;animation:fadeUp .28s ease both}
.ev-mgmt-title{font-weight:700;font-size:13px;margin-bottom:3px}
.ev-mgmt-sub{font-size:11px;color:var(--muted);margin-bottom:9px}
.ev-mgmt-foot{display:flex;gap:7px}
</style>
</head>
<body>

<div class="toast" id="toast"></div>

<!-- â•â• ĞĞĞ‘ĞĞ Ğ”Ğ˜ĞĞ“ â•â• -->
<div class="page" id="pgOnboard">
  <span class="ob-ico">ğŸŸ</span>
  <div class="ob-logo">TicketBot</div>
  <div class="ob-sub">ĞŸĞ¾ĞºÑƒĞ¿Ğ°Ğ¹ Ğ¸ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ²Ğ°Ğ¹ Ğ±Ğ¸Ğ»ĞµÑ‚Ñ‹<br>Ğ½Ğ° Ğ»ÑƒÑ‡ÑˆĞ¸Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ² Telegram</div>
  <div class="role-cards">
    <div class="rc buyer" style="animation:fadeUp .35s .1s ease both" onclick="APP.chooseRole('buyer')">
      <span class="rc-ico">ğŸ«</span>
      <div><div class="rc-title">Ğ¯ Ğ¿Ğ¾ĞºÑƒĞ¿Ğ°Ñ‚ĞµĞ»ÑŒ</div><div class="rc-desc">Ğ˜Ñ‰Ñƒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¸ Ğ¿Ğ¾ĞºÑƒĞ¿Ğ°Ñ Ğ±Ğ¸Ğ»ĞµÑ‚Ñ‹</div></div>
      <span class="rc-arr">â†’</span>
    </div>
    <div class="rc seller" style="animation:fadeUp .35s .2s ease both" onclick="APP.chooseRole('seller')">
      <span class="rc-ico">ğŸª</span>
      <div><div class="rc-title">Ğ¯ Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ°Ñ‚Ğ¾Ñ€</div><div class="rc-desc">Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¸ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ñ Ğ±Ğ¸Ğ»ĞµÑ‚Ñ‹</div></div>
      <span class="rc-arr">â†’</span>
    </div>
  </div>
</div>

<!-- â•â• ĞŸĞĞšĞ£ĞŸĞĞ¢Ğ•Ğ›Ğ¬ â•â• -->
<div class="page hide" id="pgBuyer">
  <div class="hdr">
    <div class="hdr-top">
      <div class="logo">ğŸŸ TicketBot</div>
      <div class="hbtns">
        <div class="hbtn" onclick="APP.openCart()">ğŸ›’<span class="hbadge" id="cartBadge"></span></div>
        <div class="hbtn" style="font-size:11px;color:var(--muted)" onclick="APP.switchRole()">ğŸª ĞÑ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ°Ñ‚Ğ¾Ñ€</div>
      </div>
    </div>
    <div class="srch"><span class="srch-ic">ğŸ”</span><input type="text" id="searchInput" placeholder="ĞŸĞ¾Ğ¸ÑĞº ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹..." oninput="APP.filterEvents()"></div>
    <div class="chips" id="chipsBar"></div>
  </div>
  <div class="scr" id="evList"></div>
  <div class="bbar" id="buyerBBar" style="display:none">
    <button class="btn bp" onclick="APP.openCart()">ğŸ›’ ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ° Â· <span id="cartSum"></span></button>
  </div>
</div>

<!-- â•â• Ğ”Ğ•Ğ¢ĞĞ›Ğ˜ Ğ¡ĞĞ‘Ğ«Ğ¢Ğ˜Ğ¯ â•â• -->
<div class="page hide" id="pgDetail">
  <div class="d-hero" id="dHero">
    <button class="back-btn" onclick="APP.goTo('pgBuyer')">â† ĞĞ°Ğ·Ğ°Ğ´</button>
    <span class="d-he" id="dEmoji"></span>
  </div>
  <div class="scr" style="padding-top:0">
    <div style="padding:12px">
      <div class="d-cat" id="dCat"></div>
      <div class="d-title" id="dTitle"></div>
      <div class="ig" id="dGrid"></div>
      <div class="d-desc" id="dDesc"></div>
      <div class="sec">ğŸ« Ğ¢Ğ¸Ğ¿ Ğ±Ğ¸Ğ»ĞµÑ‚Ğ°</div>
      <div class="tt-list" id="ttList"></div>
      <div class="qty-row">
        <span class="qty-lbl">ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾</span>
        <div class="qty-ctrl">
          <button class="qty-btn" onclick="APP.changeQty(-1)">âˆ’</button>
          <span class="qty-n" id="qtyNum">1</span>
          <button class="qty-btn" onclick="APP.changeQty(1)">+</button>
        </div>
      </div>
    </div>
  </div>
  <div class="bbar">
    <button class="btn bp" id="addBtn" onclick="APP.addToCart()" disabled>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ‚Ğ¸Ğ¿ Ğ±Ğ¸Ğ»ĞµÑ‚Ğ°</button>
  </div>
</div>

<!-- â•â• ĞšĞĞ Ğ—Ğ˜ĞĞ SHEET â•â• -->
<div class="sh-wrap" id="shCart">
  <div class="sh-ov" onclick="APP.closeCart()"></div>
  <div class="sh-body">
    <div class="sh-handle"></div>
    <div class="sh-hdr">
      <span class="sh-title">ğŸ›’ ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ°</span>
      <div class="sh-x" onclick="APP.closeCart()">âœ•</div>
    </div>
    <div class="sh-scr" id="cartContent"></div>
    <div class="sh-foot">
      <button class="btn bp" id="payBtn" onclick="APP.pay()">ĞÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ‚ÑŒ Ğ·Ğ°ĞºĞ°Ğ·</button>
    </div>
  </div>
</div>

<!-- â•â• Ğ£Ğ¡ĞŸĞ•Ğ¥ SHEET â•â• -->
<div class="sh-wrap" id="shSuccess">
  <div class="sh-ov"></div>
  <div class="sh-body">
    <div class="sh-handle"></div>
    <span class="suc-ico">ğŸ‰</span>
    <div class="suc-title">Ğ—Ğ°ĞºĞ°Ğ· Ğ¾Ñ„Ğ¾Ñ€Ğ¼Ğ»ĞµĞ½!</div>
    <div class="suc-sub">Ğ‘Ğ¸Ğ»ĞµÑ‚ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½ Ğ² Ğ±Ğ¾Ñ‚! ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ ğŸŸ<br><br>Ğ‘Ğ¾Ñ‚ Ğ¿Ñ€Ğ¸ÑˆĞ»Ñ‘Ñ‚ PDF-Ñ„Ğ°Ğ¹Ğ» Ñ QR-ĞºĞ¾Ğ´Ğ¾Ğ¼ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ° Ğ½Ğ° Ğ¼ĞµÑ€Ğ¾Ğ¿Ñ€Ğ¸ÑÑ‚Ğ¸Ğµ.</div>
    <button class="btn bp" onclick="APP.closeSuccess()" style="margin-bottom:8px">âœ… ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾!</button>
  </div>
</div>

<!-- â•â• ĞŸĞ ĞĞ”ĞĞ’Ğ•Ğ¦ â•â• -->
<div class="page hide" id="pgSeller">
  <div class="hdr">
    <div class="hdr-top">
      <div class="logo">ğŸª ĞšĞ°Ğ±Ğ¸Ğ½ĞµÑ‚</div>
      <div class="hbtns">
        <div class="hbtn" style="font-size:11px;color:var(--muted)" onclick="APP.switchRole()">ğŸ« ĞŸĞ¾ĞºÑƒĞ¿Ğ°Ñ‚ĞµĞ»ÑŒ</div>
      </div>
    </div>
    <div class="sel-tabs" id="selTabs">
      <div class="s-tab on" onclick="APP.sellerTab('stats')">ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°</div>
      <div class="s-tab" onclick="APP.sellerTab('events')">ğŸ“… Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ</div>
      <div class="s-tab" onclick="APP.sellerTab('add')">â• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ</div>
      <div class="s-tab" onclick="APP.sellerTab('scan')">ğŸ“· Ğ¡ĞºĞ°Ğ½ĞµÑ€</div>
      <div class="s-tab" onclick="APP.sellerTab('promo')">ğŸ· ĞŸÑ€Ğ¾Ğ¼Ğ¾</div>
    </div>
  </div>
  <div class="scr" id="selContent"></div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ĞšĞĞĞ¤Ğ˜Ğ“
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CFG = {
  API: "https://tax-standings-season-rural.trycloudflare.com",  // â† Ğ·Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ½Ğ° URL Ğ²Ğ°ÑˆĞµĞ³Ğ¾ Ğ±Ğ¾Ñ‚Ğ°
  CURRENCY: "ÑÑƒĞ¼",
  MAX_QTY: 8
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TELEGRAM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TG = window.Telegram?.WebApp || null;
if (TG) {
  TG.ready();
  TG.expand();
  TG.setHeaderColor?.('#080812');
  TG.setBackgroundColor?.('#080812');
}
const TG_USER_ID = TG?.initDataUnsafe?.user?.id || null;
const TG_INIT_DATA = TG?.initData || '';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ”Ğ•ĞœĞ Ğ”ĞĞĞĞ«Ğ•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DEMO_EVENTS = [
  {id:1, title:"Imagine Dragons Live", category:"concert", emoji:"ğŸµ", venue:"ĞœĞ¸Ğ»Ğ»Ğ¸Ğ¹ Ğ±Ğ¾Ò“ Ğ°Ğ¼Ñ„Ğ¸Ñ‚ĞµĞ°Ñ‚Ñ€Ğ¸", city:"Ğ¢Ğ¾ÑˆĞºĞµĞ½Ñ‚", date:"15.06.2025", time:"19:00", age_rating:"12+",
   description:"Ğ“Ñ€Ğ°Ğ½Ğ´Ğ¸Ğ¾Ğ·Ğ½Ğ¾Ğµ ÑˆĞ¾Ñƒ Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğ³Ğ¾ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ. Ğ›Ğ°Ğ·ĞµÑ€Ñ‹, ĞºĞ¾Ğ½Ñ„ĞµÑ‚Ñ‚Ğ¸ Ğ¸ Ñ…Ğ¸Ñ‚Ñ‹ Ğ¸Ğ· Ğ²ÑĞµÑ… Ğ°Ğ»ÑŒĞ±Ğ¾Ğ¼Ğ¾Ğ². Ğ–Ğ¸Ğ²Ğ¾Ğ¹ Ğ·Ğ²ÑƒĞº, 3 Ñ‡Ğ°ÑĞ° Ğ½ĞµĞ·Ğ°Ğ±Ñ‹Ğ²Ğ°ĞµĞ¼Ğ¾Ğ¹ Ğ¼ÑƒĞ·Ñ‹ĞºĞ¸!",
   ticket_types:[{id:1,name:"Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚",price:350000,available:120,total:200},{id:2,name:"VIP",price:850000,available:8,total:30},{id:3,name:"Ğ¡Ñ‚ÑƒĞ´ĞµĞ½Ñ‚",price:220000,available:40,total:50}]},
  {id:2, title:"ĞœÑƒÑĞ¸Ò›Ğ°Ğ»Ğ¸ ĞšĞµÑ‡Ğ°", category:"theater", emoji:"ğŸ­", venue:"ĞĞ°Ğ²Ğ¾Ğ¸Ğ¹ Ñ‚ĞµĞ°Ñ‚Ñ€Ğ¸", city:"Ğ¢Ğ¾ÑˆĞºĞµĞ½Ñ‚", date:"22.06.2025", time:"18:30", age_rating:"0+",
   description:"ĞšĞ»Ğ°ÑÑĞ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑĞ¿ĞµĞºÑ‚Ğ°ĞºĞ»ÑŒ Ğ² Ğ¸ÑĞ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğ¸ Ğ²ĞµĞ´ÑƒÑ‰ĞµĞ¹ Ñ‚Ñ€ÑƒĞ¿Ğ¿Ñ‹ Ğ£Ğ·Ğ±ĞµĞºĞ¸ÑÑ‚Ğ°Ğ½Ğ°. Ğ’ĞµÑ‡ĞµÑ€ Ğ²Ñ‹ÑĞ¾ĞºĞ¾Ğ³Ğ¾ Ğ¸ÑĞºÑƒÑÑÑ‚Ğ²Ğ° Ğ¸ Ğ¿Ñ€ĞµĞºÑ€Ğ°ÑĞ½Ğ¾Ğ¹ Ğ¼ÑƒĞ·Ñ‹ĞºĞ¸.",
   ticket_types:[{id:4,name:"ĞŸĞ°Ñ€Ñ‚ĞµÑ€",price:500000,available:80,total:150},{id:5,name:"Ğ‘Ğ°Ğ»ĞºĞ¾Ğ½",price:250000,available:200,total:300},{id:6,name:"Ğ›Ğ¾Ğ¶Ğ° VIP",price:1200000,available:4,total:8}]},
  {id:3, title:"UFC Fight Night Tashkent", category:"sport", emoji:"ğŸ¥Š", venue:"Humo Arena", city:"Ğ¢Ğ¾ÑˆĞºĞµĞ½Ñ‚", date:"30.06.2025", time:"20:00", age_rating:"16+",
   description:"Ğ’ĞµÑ‡ĞµÑ€ ÑĞ¼ĞµÑˆĞ°Ğ½Ğ½Ñ‹Ñ… ĞµĞ´Ğ¸Ğ½Ğ¾Ğ±Ğ¾Ñ€ÑÑ‚Ğ². Ğ¢Ğ¾Ğ¿Ğ¾Ğ²Ñ‹Ğµ Ğ±Ğ¾Ğ¹Ñ†Ñ‹ Ğ² Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¼ ÑÑ„Ğ¸Ñ€Ğµ!",
   ticket_types:[{id:7,name:"Ğ¢Ñ€Ğ¸Ğ±ÑƒĞ½Ğ°",price:200000,available:500,total:1000},{id:8,name:"Ğ Ğ¸Ğ½Ğ³-ÑĞ°Ğ¹Ğ´",price:1500000,available:3,total:20}]},
  {id:4, title:"Tashkent Music Fest 2025", category:"festival", emoji:"ğŸª", venue:"Ğ‘Ğ¾Ñ‚Ğ°Ğ½Ğ¸ĞºĞ° Ğ±Ğ¾Ò“Ğ¸", city:"Ğ¢Ğ¾ÑˆĞºĞµĞ½Ñ‚", date:"12.07.2025", time:"12:00", age_rating:"0+",
   description:"Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ»ĞµÑ‚Ğ½Ğ¸Ğ¹ Ñ„ĞµÑÑ‚Ğ¸Ğ²Ğ°Ğ»ÑŒ Ñ 30+ Ğ°Ñ€Ñ‚Ğ¸ÑÑ‚Ğ°Ğ¼Ğ¸ Ğ½Ğ° 5 ÑÑ†ĞµĞ½Ğ°Ñ…. Ğ•Ğ´Ğ°, Ñ€Ğ°Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ñ, Ğ¶Ğ¸Ğ²Ğ°Ñ Ğ¼ÑƒĞ·Ñ‹ĞºĞ°!",
   ticket_types:[{id:9,name:"ĞĞ´Ğ½Ğ¾Ğ´Ğ½ĞµĞ²Ğ½Ñ‹Ğ¹",price:450000,available:1000,total:5000},{id:10,name:"VIP-Ğ·Ğ¾Ğ½Ğ°",price:1200000,available:50,total:100}]},
  {id:5, title:"ĞĞ·Ğ±ĞµĞº Ğ Ğ°ÑÑĞ¾Ğ¼Ğ»Ğ°Ñ€Ğ¸", category:"exhibition", emoji:"ğŸ–¼", venue:"Ğ¡Ğ°Ğ½ÑŠĞ°Ñ‚ Ğ¼ÑƒĞ·ĞµĞ¹Ğ¸", city:"Ğ¢Ğ¾ÑˆĞºĞµĞ½Ñ‚", date:"01.06.2025", time:"10:00", age_rating:"0+",
   description:"Ğ’Ñ‹ÑÑ‚Ğ°Ğ²ĞºĞ° ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ ÑƒĞ·Ğ±ĞµĞºÑĞºĞ¾Ğ³Ğ¾ Ğ¸ÑĞºÑƒÑÑÑ‚Ğ²Ğ°. Ğ–Ğ¸Ğ²Ğ¾Ğ¿Ğ¸ÑÑŒ, ÑĞºÑƒĞ»ÑŒĞ¿Ñ‚ÑƒÑ€Ğ°, Ğ¸Ğ½ÑÑ‚Ğ°Ğ»Ğ»ÑÑ†Ğ¸Ğ¸.",
   ticket_types:[{id:11,name:"Ğ’Ğ·Ñ€Ğ¾ÑĞ»Ñ‹Ğ¹",price:80000,available:300,total:500},{id:12,name:"Ğ›ÑŒĞ³Ğ¾Ñ‚Ğ½Ñ‹Ğ¹",price:40000,available:100,total:200}]},
];
const DEMO_STATS = {users:1284, orders:847, revenue:324050000, tickets:1893};
const DEMO_PROMOS = [
  {id:1, code:"SUMMER25", type:"percent", value:25, used:14, max:100, active:true},
  {id:2, code:"VIP500", type:"fixed", value:500000, used:3, max:10, active:true},
  {id:3, code:"WELCOME", type:"percent", value:10, used:87, max:200, active:false},
];

const CAT = {all:"ğŸŒ Ğ’ÑĞµ", concert:"ğŸµ ĞšĞ¾Ğ½Ñ†ĞµÑ€Ñ‚Ñ‹", theater:"ğŸ­ Ğ¢ĞµĞ°Ñ‚Ñ€", sport:"âš½ Ğ¡Ğ¿Ğ¾Ñ€Ñ‚", exhibition:"ğŸ–¼ Ğ’Ñ‹ÑÑ‚Ğ°Ğ²ĞºĞ¸", festival:"ğŸª Ğ¤ĞµÑÑ‚Ğ¸Ğ²Ğ°Ğ»Ğ¸", other:"ğŸ¡ Ğ”Ñ€ÑƒĞ³Ğ¾Ğµ"};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// APP â€” ĞµĞ´Ğ¸Ğ½Ñ‹Ğ¹ Ğ¾Ğ±ÑŠĞµĞºÑ‚, Ğ½Ğ¸ĞºĞ°ĞºĞ¸Ñ… ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¾Ğ² Ğ¸Ğ¼Ñ‘Ğ½
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const APP = (() => {
  // Ğ¡ĞĞ¡Ğ¢ĞĞ¯ĞĞ˜Ğ•
  let state = {
    role: localStorage.getItem('tb_role') || '',
    cart: JSON.parse(localStorage.getItem('tb_cart') || '[]'),
    events: [],
    curEvent: null,
    curTicketType: null,   // Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ Ğ±Ğ¸Ğ»ĞµÑ‚Ğ°
    qty: 1,
    filter: 'all',
    sellerTab: 'stats',
  };

  // â”€â”€ Ğ¥Ğ•Ğ›ĞŸĞ•Ğ Ğ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  function fmt(n) {
    return Number(n).toLocaleString('ru') + ' ' + CFG.CURRENCY;
  }

  function haptic(type) {
    TG?.HapticFeedback?.selectionChanged?.();
    if (type === 'success') TG?.HapticFeedback?.notificationOccurred?.('success');
    if (type === 'error')   TG?.HapticFeedback?.notificationOccurred?.('error');
  }

  function showToast(msg, type='') {
    const el = document.getElementById('toast');
    el.textContent = msg;
    el.className = 'toast ' + type + ' show';
    clearTimeout(el._t);
    el._t = setTimeout(() => el.classList.remove('show'), 2700);
  }

  // â”€â”€ ĞĞĞ’Ğ˜Ğ“ĞĞ¦Ğ˜Ğ¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  function goTo(pageId) {
    document.querySelectorAll('.page').forEach(p => p.classList.add('hide'));
    const pg = document.getElementById(pageId);
    if (!pg) return;
    pg.classList.remove('hide');
    pg.style.transition = 'none';
    pg.style.opacity = '0';
    pg.style.transform = 'translateX(14px)';
    requestAnimationFrame(() => requestAnimationFrame(() => {
      pg.style.transition = 'opacity .25s,transform .25s';
      pg.style.opacity = '1';
      pg.style.transform = 'translateX(0)';
    }));
  }

  // â”€â”€ Ğ ĞĞ›Ğ¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  function chooseRole(role) {
    haptic();
    state.role = role;
    localStorage.setItem('tb_role', role);
    if (role === 'buyer') {
      loadEvents();
      goTo('pgBuyer');
    } else {
      goTo('pgSeller');
      renderStats();
    }
  }

  function switchRole() {
    haptic();
    const newRole = state.role === 'buyer' ? 'seller' : 'buyer';
    state.role = newRole;
    localStorage.setItem('tb_role', newRole);
    if (newRole === 'buyer') {
      loadEvents();
      goTo('pgBuyer');
    } else {
      goTo('pgSeller');
      sellerTab('stats');
    }
  }

  // â”€â”€ API Ğ—ĞĞŸĞ ĞĞ¡Ğ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  async function apiFetch(path, options = {}) {
    const headers = {
      'Content-Type': 'application/json',
      'X-User-Id': TG_USER_ID || '',
      'X-Init-Data': TG_INIT_DATA,
      ...(options.headers || {})
    };
    const resp = await fetch(CFG.API + path, { ...options, headers });
    if (!resp.ok) throw new Error('HTTP ' + resp.status);
    return resp.json();
  }

  // â”€â”€ Ğ¡ĞĞ‘Ğ«Ğ¢Ğ˜Ğ¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  async function loadEvents() {
    renderSkeletons();
    try {
      const data = await apiFetch('/api/events');
      state.events = data;
    } catch {
      state.events = DEMO_EVENTS; // fallback Ğ½Ğ° Ğ´ĞµĞ¼Ğ¾
    }
    renderChips();
    filterEvents();
  }

  function renderSkeletons() {
    document.getElementById('evList').innerHTML = '<div class="ev-list">' +
      [1,2,3].map(i => `
        <div class="ev-card" style="animation-delay:${i*.08}s">
          <div class="ev-inner">
            <div class="ev-poster skel" style="min-height:106px;width:88px"></div>
            <div class="ev-body" style="gap:8px">
              ${[55,88,68,48].map(w=>`<div class="skel" style="height:9px;width:${w}%"></div>`).join('')}
            </div>
          </div>
        </div>`).join('') + '</div>';
  }

  function renderChips() {
    const cats = ['all', ...new Set(state.events.map(e => e.category))];
    document.getElementById('chipsBar').innerHTML = cats.map(c =>
      `<div class="chip ${c===state.filter?'on':''}" onclick="APP.setFilter('${c}')">${CAT[c]||c}</div>`
    ).join('');
  }

  function setFilter(c) {
    state.filter = c;
    haptic();
    renderChips();
    filterEvents();
  }

  function filterEvents() {
    const q = (document.getElementById('searchInput')?.value||'').toLowerCase();
    const filtered = state.events.filter(e => {
      const mc = state.filter === 'all' || e.category === state.filter;
      const mq = !q || e.title.toLowerCase().includes(q) || (e.city||'').toLowerCase().includes(q);
      return mc && mq;
    });
    renderEvents(filtered);
  }

  function renderEvents(list) {
    const el = document.getElementById('evList');
    if (!list.length) {
      el.innerHTML = '<div class="empty"><div class="empty-ico">ğŸ”</div><div>ĞĞ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾</div></div>';
      return;
    }
    el.innerHTML = '<div class="ev-list">' + list.map((ev, i) => {
      const minPrice = Math.min(...ev.ticket_types.map(t => t.price));
      const totalAvail = ev.ticket_types.reduce((s, t) => s + t.available, 0);
      const isLow = totalAvail <= 20;
      return `
        <div class="ev-card" style="animation-delay:${i*.05}s" onclick="APP.openEvent(${ev.id})">
          <div class="ev-inner">
            <div class="ev-poster">
              ${ev.poster_url ? `<img src="${ev.poster_url}" loading="lazy">` : ''}
              <span class="ev-pe">${ev.emoji||'ğŸ¡'}</span>
            </div>
            <div class="ev-body">
              <div class="ev-cat">${CAT[ev.category]||ev.category}</div>
              <div class="ev-title">${ev.title}</div>
              <div class="ev-meta">ğŸ“… ${ev.date} Â· ${ev.time}</div>
              <div class="ev-meta">ğŸ“ ${ev.venue}, ${ev.city}</div>
              <div class="ev-foot">
                <div class="ev-price">Ğ¾Ñ‚ ${fmt(minPrice)}</div>
                <div class="seat-tag ${isLow?'low':''}">${isLow?'ğŸ”¥ ':''}${totalAvail} Ğ¼ĞµÑÑ‚</div>
              </div>
            </div>
          </div>
        </div>`;
    }).join('') + '</div>';
  }

  // â”€â”€ Ğ”Ğ•Ğ¢ĞĞ›Ğ˜ Ğ¡ĞĞ‘Ğ«Ğ¢Ğ˜Ğ¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  function openEvent(id) {
    const ev = state.events.find(e => e.id === id);
    if (!ev) return;
    state.curEvent = ev;
    state.curTicketType = null;
    state.qty = 1;

    // Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ hero
    const hero = document.getElementById('dHero');
    hero.querySelectorAll('img').forEach(i => i.remove());
    if (ev.poster_url) {
      const img = document.createElement('img');
      img.src = ev.poster_url;
      hero.appendChild(img);
    }
    document.getElementById('dEmoji').textContent = ev.emoji || 'ğŸ¡';
    document.getElementById('dCat').textContent = CAT[ev.category] || ev.category;
    document.getElementById('dTitle').textContent = ev.title;
    document.getElementById('qtyNum').textContent = '1';

    // ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ
    const descEl = document.getElementById('dDesc');
    if (ev.description) { descEl.style.display = 'block'; descEl.textContent = ev.description; }
    else descEl.style.display = 'none';

    // Ğ˜Ğ½Ñ„Ğ¾ ÑĞµÑ‚ĞºĞ°
    document.getElementById('dGrid').innerHTML = `
      <div class="ib"><div class="ibl">ğŸ“… Ğ”Ğ°Ñ‚Ğ°</div><div class="ibv">${ev.date}</div></div>
      <div class="ib"><div class="ibl">ğŸ• Ğ’Ñ€ĞµĞ¼Ñ</div><div class="ibv">${ev.time}</div></div>
      <div class="ib"><div class="ibl">ğŸ“ ĞœĞµÑÑ‚Ğ¾</div><div class="ibv">${ev.venue}</div></div>
      <div class="ib"><div class="ibl">ğŸ” Ğ’Ğ¾Ğ·Ñ€Ğ°ÑÑ‚</div><div class="ibv">${ev.age_rating}</div></div>`;

    // Ğ¢Ğ¸Ğ¿Ñ‹ Ğ±Ğ¸Ğ»ĞµÑ‚Ğ¾Ğ²
    document.getElementById('ttList').innerHTML = ev.ticket_types.map(tt => {
      const so = tt.available === 0;
      const low = !so && tt.available <= 10;
      return `
        <div class="tt-card ${so?'soldout':''}" id="tt_${tt.id}" onclick="${so ? '' : `APP.selectTicket(${tt.id})`}">
          <div>
            <div class="tt-nm">${tt.name}${low?'<span class="tag-hot">ĞœĞ°Ğ»Ğ¾</span>':''}</div>
            <div class="tt-av ${low?'low':''}">${so ? 'ĞĞµÑ‚ Ğ¼ĞµÑÑ‚' : `${tt.available} / ${tt.total} Ğ¼ĞµÑÑ‚`}</div>
          </div>
          <div style="display:flex;align-items:center">
            <div class="tt-pr">${fmt(tt.price)}</div>
            <div class="tt-rd" id="rd_${tt.id}">${so?'âœ•':''}</div>
          </div>
        </div>`;
    }).join('');

    updateAddBtn();
    haptic();
    goTo('pgDetail');
  }

  function selectTicket(ttId) {
    if (!state.curEvent) return;
    const tt = state.curEvent.ticket_types.find(t => t.id === ttId);
    if (!tt || tt.available === 0) return;

    state.curTicketType = tt;
    state.qty = 1;

    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ» ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞµĞº
    state.curEvent.ticket_types.forEach(t => {
      const card = document.getElementById('tt_' + t.id);
      const rd   = document.getElementById('rd_' + t.id);
      if (card) card.classList.remove('active-tt');
      if (rd && t.available > 0) rd.textContent = '';
    });
    const selCard = document.getElementById('tt_' + ttId);
    const selRd   = document.getElementById('rd_' + ttId);
    if (selCard) selCard.classList.add('active-tt');
    if (selRd)   selRd.textContent = 'âœ“';

    document.getElementById('qtyNum').textContent = '1';
    haptic();
    updateAddBtn();
  }

  function changeQty(delta) {
    if (!state.curTicketType) return;
    const max = Math.min(state.curTicketType.available, CFG.MAX_QTY);
    state.qty = Math.max(1, Math.min(max, state.qty + delta));
    document.getElementById('qtyNum').textContent = state.qty;
    haptic();
    updateAddBtn();
  }

  function updateAddBtn() {
    const btn = document.getElementById('addBtn');
    if (!btn) return;
    if (!state.curTicketType) {
      btn.textContent = 'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ‚Ğ¸Ğ¿ Ğ±Ğ¸Ğ»ĞµÑ‚Ğ°';
      btn.disabled = true;
    } else {
      btn.textContent = `ğŸ›’ Ğ’ ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñƒ â€” ${fmt(state.curTicketType.price * state.qty)}`;
      btn.disabled = false;
    }
  }

  // â”€â”€ ĞšĞĞ Ğ—Ğ˜ĞĞ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  function addToCart() {
    if (!state.curTicketType || !state.curEvent) return;
    const ev = state.curEvent;
    const tt = state.curTicketType;
    const existing = state.cart.find(c => c.tt_id === tt.id);
    if (existing) {
      existing.qty = Math.min(existing.qty + state.qty, CFG.MAX_QTY);
    } else {
      state.cart.push({
        event_id:    ev.id,
        event_title: ev.title,
        event_date:  ev.date,
        event_time:  ev.time,
        event_age:   ev.age_rating,
        venue:       ev.venue,
        tt_id:       tt.id,
        tt_name:     tt.name,
        price:       tt.price,
        qty:         state.qty,
      });
    }
    saveCart();
    haptic('success');
    showToast('âœ… Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ² ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñƒ!', 'ok');
    goTo('pgBuyer');
  }

  function saveCart() {
    localStorage.setItem('tb_cart', JSON.stringify(state.cart));
    updateCartUI();
  }

  function updateCartUI() {
    const totalQty = state.cart.reduce((s, i) => s + i.qty, 0);
    const totalSum = state.cart.reduce((s, i) => s + i.price * i.qty, 0);

    const badge = document.getElementById('cartBadge');
    if (badge) { badge.textContent = totalQty; badge.classList.toggle('on', totalQty > 0); }

    const bbar = document.getElementById('buyerBBar');
    if (bbar) bbar.style.display = state.cart.length ? 'block' : 'none';

    const sumEl = document.getElementById('cartSum');
    if (sumEl) sumEl.textContent = totalSum > 0 ? fmt(totalSum) : '';
  }

  function openCart() {
    renderCartContent();
    document.getElementById('shCart').classList.add('on');
  }

  function closeCart() {
    document.getElementById('shCart').classList.remove('on');
  }

  function removeFromCart(ttId) {
    state.cart = state.cart.filter(i => i.tt_id !== ttId);
    saveCart();
    renderCartContent();
    haptic();
  }

  function renderCartContent() {
    const content = document.getElementById('cartContent');
    const payBtn  = document.getElementById('payBtn');
    if (!state.cart.length) {
      content.innerHTML = '<div class="empty"><div class="empty-ico">ğŸ›’</div><div>ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ° Ğ¿ÑƒÑÑ‚Ğ°</div></div>';
      payBtn.disabled = true;
      payBtn.textContent = 'ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ° Ğ¿ÑƒÑÑ‚Ğ°';
      return;
    }
    const total = state.cart.reduce((s, i) => s + i.price * i.qty, 0);
    payBtn.disabled = false;
    payBtn.textContent = `ğŸ’³ ĞĞ¿Ğ»Ğ°Ñ‚Ğ¸Ñ‚ÑŒ â€” ${fmt(total)}`;
    content.innerHTML = state.cart.map(item => `
      <div class="ci">
        <div class="ci-title">${item.event_title}</div>
        <div class="ci-sub">ğŸ« ${item.tt_name} Ã— ${item.qty} ÑˆÑ‚ &nbsp;|&nbsp; ğŸ“… ${item.event_date} ${item.event_time}</div>
        <div class="ci-foot">
          <div class="ci-price">${fmt(item.price * item.qty)}</div>
          <button class="btn bd bsm" onclick="APP.removeFromCart(${item.tt_id})">âœ• Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ</button>
        </div>
      </div>`).join('') +
      `<div class="total-row">
        <span class="total-lbl">Ğ˜Ñ‚Ğ¾Ğ³Ğ¾</span>
        <span class="total-val">${fmt(total)}</span>
      </div>`;
  }

  // â”€â”€ ĞĞŸĞ›ĞĞ¢Ğ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  async function pay() {
    if (!state.cart.length) return;
    const btn = document.getElementById('payBtn');
    btn.disabled = true;
    btn.innerHTML = '<div class="ld"></div>';
    haptic();

    const orderData = {
      user_id:   TG_USER_ID,
      items:     state.cart,
      total:     state.cart.reduce((s, i) => s + i.price * i.qty, 0),
    };

    try {
      await apiFetch('/api/order', { method: 'POST', body: JSON.stringify(orderData) });
    } catch (e) {
      // Ğ’ Ğ´ĞµĞ¼Ğ¾ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ğ²ÑÑ‘ Ñ€Ğ°Ğ²Ğ½Ğ¾ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ÑƒÑĞ¿ĞµÑ…
      // Ğ‘Ğ¾Ñ‚ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ Ñ‡ĞµÑ€ĞµĞ· TG.sendData ĞµÑĞ»Ğ¸ API Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½
      if (TG) {
        try { TG.sendData(JSON.stringify({ action: 'order', ...orderData })); } catch {}
      }
    }

    state.cart = [];
    saveCart();
    closeCart();
    setTimeout(() => {
      document.getElementById('shSuccess').classList.add('on');
      haptic('success');
    }, 320);
  }

  function closeSuccess() {
    document.getElementById('shSuccess').classList.remove('on');
    goTo('pgBuyer');
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ĞŸĞ ĞĞ”ĞĞ’Ğ•Ğ¦
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  function sellerTab(tab) {
    state.sellerTab = tab;
    const tabs = ['stats','events','add','scan','promo'];
    document.querySelectorAll('.s-tab').forEach((el, i) => el.classList.toggle('on', tabs[i] === tab));
    haptic();
    const renders = { stats: renderStats, events: renderMyEvents, add: renderAddEvent, scan: renderScanner, promo: renderPromos };
    renders[tab]?.();
  }

  // â”€â”€ Ğ¡Ğ¢ĞĞ¢Ğ˜Ğ¡Ğ¢Ğ˜ĞšĞ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  async function renderStats() {
    const c = document.getElementById('selContent');
    c.innerHTML = '<div class="empty"><div class="ld"></div></div>';
    let stats = DEMO_STATS;
    try { stats = await apiFetch('/api/admin/stats'); } catch {}
    c.innerHTML = `
      <div class="stat-grid">
        ${[['ğŸ‘¥',stats.users,'ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹'],['ğŸ›’',stats.orders,'Ğ—Ğ°ĞºĞ°Ğ·Ğ¾Ğ²'],['ğŸŸ',stats.tickets,'Ğ‘Ğ¸Ğ»ĞµÑ‚Ğ¾Ğ² Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ½Ğ¾'],['ğŸ’°',fmt(stats.revenue),'Ğ’Ñ‹Ñ€ÑƒÑ‡ĞºĞ°']].map((s,i)=>`
        <div class="stat-card" style="animation-delay:${i*.07}s">
          <div class="st-ico">${s[0]}</div>
          <div class="st-val">${typeof s[1]==='number'?s[1].toLocaleString('ru'):s[1]}</div>
          <div class="st-lbl">${s[2]}</div>
        </div>`).join('')}
      </div>
      <div class="sec">ğŸ“… Ğ¡Ğ²Ğ¾Ğ´ĞºĞ° Ğ¿Ğ¾ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸ÑĞ¼</div>
      <p style="font-size:12px;color:var(--muted);margin-bottom:12px">ĞŸĞµÑ€ĞµĞ¹Ğ´Ğ¸Ñ‚Ğµ Ğ² Ñ€Ğ°Ğ·Ğ´ĞµĞ» Â«Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸ÑÂ» Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ</p>
      <button class="btn bp" onclick="APP.sellerTab('events')" style="margin-bottom:16px">ğŸ“… Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸ÑĞ¼Ğ¸</button>`;
  }

  // â”€â”€ ĞœĞĞ˜ Ğ¡ĞĞ‘Ğ«Ğ¢Ğ˜Ğ¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  async function renderMyEvents() {
    const c = document.getElementById('selContent');
    c.innerHTML = '<div class="empty"><div class="ld"></div></div>';
    let evs = DEMO_EVENTS;
    try { evs = await apiFetch('/api/events'); } catch {}
    if (!evs.length) {
      c.innerHTML = '<div class="empty"><div class="empty-ico">ğŸ“­</div><div>ĞĞµÑ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹</div></div>' +
        '<button class="btn bp" onclick="APP.sellerTab(\'add\')" style="margin:16px 0">â• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿ĞµÑ€Ğ²Ğ¾Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ</button>';
      return;
    }
    c.innerHTML = '<div class="sec">ğŸ“… Ğ’ÑĞµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ</div>' +
      evs.map((ev, i) => {
        const sold = ev.ticket_types.reduce((s, t) => s + (t.total - t.available), 0);
        const tot  = ev.ticket_types.reduce((s, t) => s + t.total, 0);
        const pct  = tot > 0 ? Math.round(sold / tot * 100) : 0;
        const rev  = ev.ticket_types.reduce((s, t) => s + (t.total - t.available) * t.price, 0);
        return `
          <div class="ev-mgmt-card" style="animation-delay:${i*.06}s">
            <div class="ev-mgmt-title">${ev.emoji||'ğŸ¡'} ${ev.title}</div>
            <div class="ev-mgmt-sub">ğŸ“… ${ev.date} Â· ğŸ“ ${ev.venue} Â· ${ev.city}</div>
            <div class="prog-bar"><div class="prog-fill" style="width:${pct}%"></div></div>
            <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--muted);margin-bottom:10px">
              <span>ĞŸÑ€Ğ¾Ğ´Ğ°Ğ½Ğ¾ ${sold}/${tot} (${pct}%)</span>
              <span style="color:var(--green);font-weight:700">${fmt(rev)}</span>
            </div>
            <div class="ev-mgmt-foot">
              <button class="btn bs bsm" onclick="APP.editEvent(${ev.id})" style="flex:1">âœï¸ Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ</button>
              <button class="btn bd bsm" onclick="APP.deleteEvent(${ev.id})" style="flex:1">ğŸ—‘ Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ</button>
            </div>
          </div>`;
      }).join('') +
      '<button class="btn bp" onclick="APP.sellerTab(\'add\')" style="margin-top:8px;margin-bottom:16px">â• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ</button>';
  }

  async function deleteEvent(id) {
    if (!confirm('Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ¾ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ?')) return;
    try { await apiFetch(`/api/admin/event/${id}`, { method: 'DELETE' }); } catch {}
    // Ğ£Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ¸Ğ· Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ´ĞµĞ¼Ğ¾-ÑĞ¿Ğ¸ÑĞºĞ° Ñ‚Ğ¾Ğ¶Ğµ
    state.events = state.events.filter(e => e.id !== id);
    haptic('success');
    showToast('ğŸ—‘ Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¾', 'ok');
    renderMyEvents();
  }

  function editEvent(id) {
    const ev = state.events.find(e => e.id === id) || DEMO_EVENTS.find(e => e.id === id);
    if (!ev) return;
    sellerTab('add');
    setTimeout(() => populateEventForm(ev), 100);
  }

  function populateEventForm(ev) {
    const g = id => document.getElementById(id);
    if (g('evId'))    g('evId').value    = ev.id;
    if (g('evTitle')) g('evTitle').value = ev.title;
    if (g('evDesc'))  g('evDesc').value  = ev.description || '';
    if (g('evCat'))   g('evCat').value   = ev.category;
    if (g('evAge'))   g('evAge').value   = ev.age_rating;
    if (g('evVenue')) g('evVenue').value = ev.venue;
    if (g('evCity'))  g('evCity').value  = ev.city;
    if (g('evDate'))  {
      const parts = ev.date.split('.');
      if (parts.length === 3) g('evDate').value = `${parts[2]}-${parts[1]}-${parts[0]}`;
    }
    if (g('evTime'))  g('evTime').value  = ev.time;
    if (g('evEmoji')) g('evEmoji').value = ev.emoji || '';
    const tt = ev.ticket_types?.[0];
    if (tt) {
      if (g('ttName'))  g('ttName').value  = tt.name;
      if (g('ttPrice')) g('ttPrice').value = tt.price;
      if (g('ttSeats')) g('ttSeats').value = tt.total;
    }
    const btn = document.getElementById('submitEvBtn');
    if (btn) btn.textContent = 'ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ';
  }

  // â”€â”€ Ğ”ĞĞ‘ĞĞ’Ğ˜Ğ¢Ğ¬ Ğ¡ĞĞ‘Ğ«Ğ¢Ğ˜Ğ• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  function renderAddEvent() {
    document.getElementById('selContent').innerHTML = `
      <div class="sec">â• ĞĞ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ</div>
      <input type="hidden" id="evId" value="">
      <div class="fld"><label class="fl">ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</label><input class="fi" id="evTitle" placeholder="Imagine Dragons Live"></div>
      <div class="fld"><label class="fl">ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ</label><textarea class="fi" id="evDesc" placeholder="ĞšÑ€Ğ°Ñ‚ĞºĞ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¼ĞµÑ€Ğ¾Ğ¿Ñ€Ğ¸ÑÑ‚Ğ¸Ñ..."></textarea></div>
      <div class="fld"><label class="fl">Ğ­Ğ¼Ğ¾Ğ´Ğ·Ğ¸ Ğ¾Ğ±Ğ»Ğ¾Ğ¶ĞºĞ¸</label><input class="fi" id="evEmoji" placeholder="ğŸµ" maxlength="2"></div>
      <div class="frow">
        <div class="fld"><label class="fl">ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ</label>
          <select class="fi" id="evCat">
            <option value="concert">ğŸµ ĞšĞ¾Ğ½Ñ†ĞµÑ€Ñ‚</option><option value="theater">ğŸ­ Ğ¢ĞµĞ°Ñ‚Ñ€</option>
            <option value="sport">âš½ Ğ¡Ğ¿Ğ¾Ñ€Ñ‚</option><option value="exhibition">ğŸ–¼ Ğ’Ñ‹ÑÑ‚Ğ°Ğ²ĞºĞ°</option>
            <option value="festival">ğŸª Ğ¤ĞµÑÑ‚Ğ¸Ğ²Ğ°Ğ»ÑŒ</option><option value="other">ğŸ¡ Ğ”Ñ€ÑƒĞ³Ğ¾Ğµ</option>
          </select>
        </div>
        <div class="fld"><label class="fl">Ğ’Ğ¾Ğ·Ñ€Ğ°ÑÑ‚</label>
          <select class="fi" id="evAge"><option>0+</option><option>6+</option><option>12+</option><option>16+</option><option>18+</option></select>
        </div>
      </div>
      <div class="fld"><label class="fl">ĞŸĞ»Ğ¾Ñ‰Ğ°Ğ´ĞºĞ°</label><input class="fi" id="evVenue" placeholder="Humo Arena"></div>
      <div class="frow">
        <div class="fld"><label class="fl">Ğ“Ğ¾Ñ€Ğ¾Ğ´</label><input class="fi" id="evCity" placeholder="Ğ¢Ğ¾ÑˆĞºĞµĞ½Ñ‚"></div>
        <div class="fld"><label class="fl">Ğ”Ğ°Ñ‚Ğ°</label><input class="fi" type="date" id="evDate"></div>
      </div>
      <div class="fld"><label class="fl">Ğ’Ñ€ĞµĞ¼Ñ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ°</label><input class="fi" type="time" id="evTime" value="19:00"></div>
      <div class="divider"></div>
      <div class="sec">ğŸ« ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ñ‚Ğ¸Ğ¿ Ğ±Ğ¸Ğ»ĞµÑ‚Ğ°</div>
      <div class="fld"><label class="fl">ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ¸Ğ¿Ğ°</label><input class="fi" id="ttName" placeholder="Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚"></div>
      <div class="frow">
        <div class="fld"><label class="fl">Ğ¦ĞµĞ½Ğ° (ÑÑƒĞ¼)</label><input class="fi" type="number" id="ttPrice" placeholder="350000"></div>
        <div class="fld"><label class="fl">ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¼ĞµÑÑ‚</label><input class="fi" type="number" id="ttSeats" placeholder="100"></div>
      </div>
      <button class="btn bp" id="submitEvBtn" onclick="APP.submitEvent()" style="margin-top:8px">âœ… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ</button>
      <div style="height:20px"></div>`;
  }

  async function submitEvent() {
    const g = id => document.getElementById(id)?.value?.trim() || '';
    const evId    = g('evId');
    const title   = g('evTitle');
    const venue   = g('evVenue');
    const city    = g('evCity');
    const dateVal = g('evDate');
    const ttName  = g('ttName');
    const ttPrice = parseFloat(g('ttPrice'));
    const ttSeats = parseInt(g('ttSeats'));

    if (!title || !venue || !city || !dateVal || !ttName || !ttPrice || !ttSeats) {
      showToast('âŒ Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ğ²ÑĞµ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ', 'err'); return;
    }

    // ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ´Ğ°Ñ‚Ñƒ Ğ¸Ğ· yyyy-mm-dd -> dd.mm.yyyy
    const dp = dateVal.split('-');
    const dateFormatted = dp.length === 3 ? `${dp[2]}.${dp[1]}.${dp[0]}` : dateVal;

    const payload = {
      title, venue, city,
      description:  g('evDesc'),
      category:     document.getElementById('evCat')?.value || 'other',
      age_rating:   document.getElementById('evAge')?.value || '0+',
      date:         dateFormatted,
      time:         g('evTime') || '19:00',
      emoji:        g('evEmoji') || 'ğŸ¡',
      ticket_types: [{ name: ttName, price: ttPrice, total: ttSeats, available: ttSeats }],
    };

    const btn = document.getElementById('submitEvBtn');
    btn.disabled = true; btn.innerHTML = '<div class="ld"></div>';

    try {
      if (evId) {
        await apiFetch(`/api/admin/event/${evId}`, { method: 'PUT', body: JSON.stringify(payload) });
      } else {
        await apiFetch('/api/admin/event', { method: 'POST', body: JSON.stringify(payload) });
      }
    } catch {
      // Ğ”ĞµĞ¼Ğ¾: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
      const newEv = { ...payload, id: Date.now(), ticket_types: payload.ticket_types };
      state.events.unshift(newEv);
    }

    haptic('success');
    showToast(evId ? 'ğŸ’¾ Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾!' : 'âœ… Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¾!', 'ok');
    renderAddEvent();
    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑĞ¿Ğ¸ÑĞ¾Ğº ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ´Ğ»Ñ Ğ¿Ğ¾ĞºÑƒĞ¿Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ñ‚Ğ¾Ğ¶Ğµ
    setTimeout(() => loadEvents(), 500);
  }

  // â”€â”€ Ğ¡ĞšĞĞĞ•Ğ  QR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  function renderScanner() {
    document.getElementById('selContent').innerHTML = `
      <div class="sec">ğŸ“· ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ±Ğ¸Ğ»ĞµÑ‚Ğ°</div>
      <div class="scan-box" id="scanBox">
        <div style="font-size:50px;margin-bottom:10px">ğŸ“·</div>
        <div style="font-weight:700;margin-bottom:5px">Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ĞºĞ¾Ğ´ Ğ±Ğ¸Ğ»ĞµÑ‚Ğ°</div>
        <div style="font-size:11px;color:var(--muted)">Ğ’ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ UUID Ğ¸Ğ· QR-ĞºĞ¾Ğ´Ğ° Ğ±Ğ¸Ğ»ĞµÑ‚Ğ°</div>
      </div>
      <div id="scanResult"></div>
      <div class="fld"><label class="fl">ĞšĞ¾Ğ´ Ğ±Ğ¸Ğ»ĞµÑ‚Ğ° (UUID)</label><input class="fi" id="qrInput" placeholder="TKT-xxxxxxxx"></div>
      <button class="btn bp" id="scanBtn" onclick="APP.validateTicket()">ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ±Ğ¸Ğ»ĞµÑ‚</button>
      <div style="height:20px"></div>`;
  }

  async function validateTicket() {
    const code = document.getElementById('qrInput')?.value?.trim();
    if (!code) { showToast('âŒ Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ĞºĞ¾Ğ´ Ğ±Ğ¸Ğ»ĞµÑ‚Ğ°', 'err'); return; }
    const btn = document.getElementById('scanBtn');
    btn.disabled = true; btn.innerHTML = '<div class="ld"></div>';
    let result = null;
    try { result = await apiFetch('/api/admin/validate', { method: 'POST', body: JSON.stringify({ qr_code: code }) }); } catch {}
    btn.disabled = false; btn.textContent = 'ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ±Ğ¸Ğ»ĞµÑ‚';

    if (!result) result = code.length > 8
      ? { status:'valid', event:'Imagine Dragons Live', ticket_type:'Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚', date:'15.06.2025 19:00', venue:'ĞœĞ¸Ğ»Ğ»Ğ¸Ğ¹ Ğ±Ğ¾Ò“' }
      : { status:'invalid' };

    const el = document.getElementById('scanResult');
    if (result.status === 'valid') {
      haptic('success');
      el.innerHTML = `<div class="scan-res ok">
        <div style="font-weight:700;margin-bottom:7px">âœ… Ğ‘Ğ˜Ğ›Ğ•Ğ¢ Ğ”Ğ•Ğ™Ğ¡Ğ¢Ğ’Ğ˜Ğ¢Ğ•Ğ›Ğ•Ğ</div>
        <div style="font-size:12px;color:var(--muted)">ğŸ­ ${result.event}</div>
        <div style="font-size:12px;color:var(--muted)">ğŸ« ${result.ticket_type}</div>
        <div style="font-size:12px;color:var(--muted)">ğŸ“… ${result.date} Â· ğŸ“ ${result.venue}</div>
      </div>`;
      showToast('âœ… Ğ‘Ğ¸Ğ»ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚!', 'ok');
    } else if (result.status === 'used') {
      haptic('error');
      el.innerHTML = '<div class="scan-res used"><div style="font-weight:700">â›” Ğ£Ğ–Ğ• Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞ</div></div>';
      showToast('â›” Ğ‘Ğ¸Ğ»ĞµÑ‚ ÑƒĞ¶Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½!', 'err');
    } else {
      haptic('error');
      el.innerHTML = '<div class="scan-res bad"><div style="font-weight:700">âŒ Ğ‘Ğ˜Ğ›Ğ•Ğ¢ ĞĞ• ĞĞĞ™Ğ”Ğ•Ğ</div></div>';
      showToast('âŒ ĞĞµĞ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ±Ğ¸Ğ»ĞµÑ‚', 'err');
    }
    document.getElementById('qrInput').value = '';
  }

  // â”€â”€ ĞŸĞ ĞĞœĞĞšĞĞ”Ğ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  let promosLocal = [...DEMO_PROMOS];

  async function renderPromos() {
    const c = document.getElementById('selContent');
    c.innerHTML = '<div class="empty"><div class="ld"></div></div>';
    try { promosLocal = await apiFetch('/api/admin/promos'); } catch {}
    c.innerHTML = `
      <div class="sec">ğŸ· ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´Ñ‹</div>
      ${promosLocal.map((p, i) => `
        <div class="promo-card" style="animation-delay:${i*.07}s">
          <div style="flex:1">
            <div class="pc">${p.code} ${p.active?'':'<span style="font-size:9px;color:var(--muted)">(Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½)</span>'}</div>
            <div class="pi">${p.type==='percent'?`âˆ’${p.value}%`:`âˆ’${fmt(p.value)}`} Â· ${p.used}/${p.max} Ğ¸ÑĞ¿.</div>
            <div class="prog-bar" style="width:80px"><div class="prog-fill" style="width:${Math.round(p.used/p.max*100)}%"></div></div>
          </div>
          <button class="btn bd bsm" onclick="APP.deletePromo(${p.id})">âœ•</button>
        </div>`).join('')}
      <div class="divider"></div>
      <div class="sec">â• ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´</div>
      <div class="fld"><label class="fl">ĞšĞ¾Ğ´</label><input class="fi" id="pcCode" placeholder="SUMMER25" oninput="this.value=this.value.toUpperCase()"></div>
      <div class="frow">
        <div class="fld"><label class="fl">Ğ¢Ğ¸Ğ¿</label>
          <select class="fi" id="pcType"><option value="percent">% ĞŸÑ€Ğ¾Ñ†ĞµĞ½Ñ‚</option><option value="fixed">ÑÑƒĞ¼ Ğ¡ÑƒĞ¼Ğ¼Ğ°</option></select>
        </div>
        <div class="fld"><label class="fl">Ğ Ğ°Ğ·Ğ¼ĞµÑ€</label><input class="fi" type="number" id="pcVal" placeholder="25"></div>
      </div>
      <div class="fld"><label class="fl">ĞœĞ°ĞºÑ. Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹</label><input class="fi" type="number" id="pcMax" placeholder="100"></div>
      <button class="btn bp" onclick="APP.createPromo()" style="margin-top:4px">âœ… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´</button>
      <div style="height:20px"></div>`;
  }

  async function deletePromo(id) {
    try { await apiFetch(`/api/admin/promo/${id}`, { method: 'DELETE' }); } catch {}
    promosLocal = promosLocal.filter(p => p.id !== id);
    haptic('success');
    showToast('ğŸ—‘ ĞŸÑ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´ ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½', 'ok');
    renderPromos();
  }

  async function createPromo() {
    const code = document.getElementById('pcCode')?.value?.trim().toUpperCase();
    const type = document.getElementById('pcType')?.value;
    const val  = parseFloat(document.getElementById('pcVal')?.value);
    const max  = parseInt(document.getElementById('pcMax')?.value);
    if (!code || !val || !max) { showToast('âŒ Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ğ²ÑĞµ Ğ¿Ğ¾Ğ»Ñ', 'err'); return; }
    try {
      await apiFetch('/api/admin/promo', { method: 'POST', body: JSON.stringify({ code, type, value: val, max_uses: max }) });
    } catch {
      promosLocal.push({ id: Date.now(), code, type, value: val, used: 0, max, active: true });
    }
    haptic('success');
    showToast(`âœ… ĞŸÑ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´ ${code} ÑĞ¾Ğ·Ğ´Ğ°Ğ½!`, 'ok');
    renderPromos();
  }

  // â”€â”€ RIPPLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  document.addEventListener('click', e => {
    const target = e.target.closest('.btn,.rc,.ev-card,.tt-card,.hbtn');
    if (!target) return;
    const el = document.createElement('span');
    el.className = 'rpl-el';
    const rc = target.getBoundingClientRect();
    const sz = Math.max(rc.width, rc.height);
    el.style.cssText = `width:${sz}px;height:${sz}px;left:${e.clientX-rc.left-sz/2}px;top:${e.clientY-rc.top-sz/2}px`;
    target.appendChild(el);
    setTimeout(() => el.remove(), 600);
  });

  // â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  function init() {
    if (state.role) {
      chooseRole(state.role);
    } else {
      goTo('pgOnboard');
    }
    updateCartUI();
  }

  // ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğµ API Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ°
  return {
    chooseRole, switchRole, goTo,
    filterEvents, setFilter,
    openEvent, selectTicket, changeQty, addToCart,
    openCart, closeCart, removeFromCart, pay, closeSuccess,
    sellerTab, renderStats, renderMyEvents, renderAddEvent, submitEvent,
    editEvent, deleteEvent, renderScanner, validateTicket,
    renderPromos, createPromo, deletePromo,
    init,
  };
})();

// Ğ—Ğ°Ğ¿ÑƒÑĞº
APP.init();
</script>
</body>
</html>
